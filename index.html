<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOL Sniper Pro - Real Time</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        :root { --bg: #0b0e11; --card: #181a20; --accent: #f0b90b; --up: #0ecb81; --down: #f6465d; }
        body { background: var(--bg); color: #eaecef; margin: 0; font-family: 'Segoe UI', Tahoma, sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        .header { background: var(--card); padding: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; border-bottom: 2px solid #2b3139; }
        .box { background: #2b3139; padding: 10px; border-radius: 6px; text-align: center; border: 1px solid transparent; transition: 0.3s; }
        .box:hover { border-color: var(--accent); }
        .val { color: var(--accent); font-weight: bold; font-size: 1.2em; display: block; }
        
        #chart { flex-grow: 1; position: relative; width: 100%; }
        .trading-panel { background: var(--card); padding: 20px; border-top: 2px solid #2b3139; display: flex; justify-content: center; gap: 20px; }
        
        button { padding: 12px 30px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1em; transition: 0.2s; }
        .btn-buy { background: var(--up); color: white; }
        .btn-sell { background: var(--down); color: white; }
        .btn-buy:active, .btn-sell:active { transform: scale(0.95); }
        
        #logs { position: absolute; top: 10px; right: 10px; width: 250px; background: rgba(24, 26, 32, 0.9); padding: 10px; border-radius: 5px; font-size: 0.8em; max-height: 200px; overflow-y: auto; z-index: 10; border: 1px solid #444; }
    </style>
</head>
<body>

    <div class="header">
        <div class="box">SOL Price <span id="price" class="val">Carregando...</span></div>
        <div class="box">Dist. Suporte (24h) <span id="dSup" class="val">---</span></div>
        <div class="box">Suporte 24h <span id="sup" class="val" style="color: var(--up)">---</span></div>
        <div class="box">Resistência 24h <span id="res" class="val" style="color: var(--down)">---</span></div>
        <div class="box">Saldo Simulado <span id="balance" class="val" style="color: #fff">U$ 10.000,00</span></div>
    </div>

    <div id="chart">
        <div id="logs"><b>Ações Sniper:</b><br></div>
    </div>

    <div class="trading-panel">
        <button class="btn-buy" onclick="trade('BUY')">COMPRAR (LONG)</button>
        <button class="btn-sell" onclick="trade('SELL')">VENDER (SHORT)</button>
    </div>

    <script>
        let lastClose = 0, currentSup = 0, currentRes = 0, balance = 10000;
        const symbol = 'solusdt';
        
        // 1. Configuração do Gráfico
        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
            layout: { background: { color: '#0b0e11' }, textColor: '#848e9c' },
            grid: { vertLines: { color: '#1f2226' }, horzLines: { color: '#1f2226' } },
            timeScale: { timeVisible: true, secondsVisible: false },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal }
        });
        const candleSeries = chart.addCandlestickSeries({ upColor: '#0ecb81', downColor: '#f6465d', borderVisible: false });

        // Ajustar gráfico ao redimensionar janela
        window.addEventListener('resize', () => {
            chart.applyOptions({ width: document.getElementById('chart').clientWidth });
        });

        // 2. Carregar Histórico Inicial (FIX: URL completa da Binance)
        async function loadHistory() {
            try {
                const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=SOLUSDT&interval=1h&limit=100`);
                const data = await res.json();
                const candles = data.map(d => ({
                    time: d[0] / 1000, 
                    open: parseFloat(d[1]), 
                    high: parseFloat(d[2]), 
                    low: parseFloat(d[3]), 
                    close: parseFloat(d[4])
                }));
                candleSeries.setData(candles);
                updateStats(candles);
                
                lastClose = candles[candles.length - 1].close;
                document.getElementById('price').innerText = `$${lastClose.toFixed(2)}`;
            } catch (e) { console.error("Erro ao carregar histórico", e); }
        }

        // 3. Conexão WebSocket (FIX: URL corrigida)
        const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbol}@kline_1h`);
        ws.onmessage = (event) => {
            const msg = JSON.parse(event.data);
            const k = msg.k;
            const candle = {
                time: k.t / 1000, 
                open: parseFloat(k.o), 
                high: parseFloat(k.h), 
                low: parseFloat(k.l), 
                close: parseFloat(k.c)
            };
            candleSeries.update(candle);
            
            lastClose = candle.close;
            document.getElementById('price').innerText = `$${lastClose.toFixed(2)}`;
            
            if(currentSup > 0) {
                const dist = ((lastClose - currentSup) / currentSup * 100).toFixed(2);
                document.getElementById('dSup').innerText = `${dist}%`;
                document.getElementById('dSup').style.color = dist < 1.0 ? '#0ecb81' : '#f0b90b';
            }
        };

        function updateStats(candles) {
            currentSup = Math.min(...candles.map(c => c.low));
            currentRes = Math.max(...candles.map(c => c.high));
            document.getElementById('sup').innerText = `$${currentSup.toFixed(2)}`;
            document.getElementById('res').innerText = `$${currentRes.toFixed(2)}`;
        }

        function trade(type) {
            const log = document.getElementById('logs');
            const color = type === 'BUY' ? '#0ecb81' : '#f6465d';
            const time = new Date().toLocaleTimeString();
            
            log.innerHTML += `<div style="color:${color}">[${time}] ${type} @ ${lastClose.toFixed(2)}</div>`;
            log.scrollTop = log.scrollHeight;
            
            // Simulação simples de lucro/perda
            if(type === 'BUY') balance -= 100; else balance += 100;
            document.getElementById('balance').innerText = `U$ ${balance.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        }

        loadHistory();
    </script>
</body>
</html>
