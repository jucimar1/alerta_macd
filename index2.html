<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéØ SOL Sniper PRO - Bollinger Bands 1h + MACD 5m</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    :root {
      --primary: #58a6ff;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
      --info: #17a2b8;
      --dark-bg: #0d1117;
      --card-bg: #161b22;
      --border-color: #30363d;
      --text-primary: #c9d1d9;
      --text-secondary: #8b949e;
      --support-color: #28a745;
      --resistance-color: #dc3545;
      --volume-color: #58a6ff;
      --rsi-oversold: #28a745;
      --rsi-overbought: #dc3545;
      --rsi-neutral: #8b949e;
      --macd-bullish: #28a745;
      --macd-bearish: #dc3545;
      --bb-upper: #ff6b6b;
      --bb-middle: #58a6ff;
      --bb-lower: #28a745;
      --chart-bg: #0a0e14;
      --grid-color: #222833;
    }
    
    body {
      background: linear-gradient(135deg, var(--dark-bg) 0%, #111827 100%);
      color: var(--text-primary);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      padding: 30px 0;
      margin-bottom: 30px;
      position: relative;
    }
    
    h1 {
      font-size: 3.5rem;
      margin-bottom: 15px;
      background: linear-gradient(90deg, var(--primary), #8a6bff, var(--success), var(--info), var(--warning));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 20px rgba(88, 166, 255, 0.3);
      letter-spacing: -0.5px;
    }
    
    .subtitle {
      font-size: 1.4rem;
      color: var(--text-secondary);
      margin-top: 10px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.5;
    }
    
    .status-bar {
      background: rgba(22, 27, 34, 0.8);
      border-radius: 50px;
      padding: 12px 30px;
      display: inline-flex;
      align-items: center;
      margin: 25px auto;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }
    
    .status-indicator {
      display: inline-block;
      width: 14px;
      height: 14px;
      background: var(--success);
      border-radius: 50%;
      margin-right: 10px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4); }
      70% { opacity: 0.7; box-shadow: 0 0 0 8px rgba(40, 167, 69, 0); }
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: 320px repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .card {
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4),
                  0 0 30px rgba(88, 166, 255, 0.08);
      padding: 28px;
      border: 1px solid var(--border-color);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--primary), var(--success), var(--info), var(--warning));
      opacity: 0.7;
    }
    
    .card.macd-card::before {
      background: linear-gradient(90deg, var(--info), #6c43f5, var(--primary));
    }
    
    .card.bb-card::before {
      background: linear-gradient(90deg, var(--bb-upper), var(--bb-middle), var(--bb-lower));
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5),
                  0 0 40px rgba(88, 166, 255, 0.15);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 22px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .card-title {
      font-size: 1.6rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .card-title i {
      font-size: 1.8rem;
    }
    
    .price-display {
      font-size: 4.2rem;
      font-weight: 800;
      text-align: center;
      margin: 25px 0;
      background: linear-gradient(90deg, var(--success), #34d399);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 15px rgba(40, 167, 69, 0.3);
      position: relative;
    }
    
    .price-display::after {
      content: '$';
      position: absolute;
      left: -25px;
      top: 0;
      font-size: 0.6em;
      opacity: 0.7;
    }
    
    .price-display small {
      font-size: 1.2rem;
      font-weight: 400;
      color: var(--text-secondary);
      margin-left: 8px;
    }
    
    .metric-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 18px;
      margin-top: 15px;
    }
    
    .metric-item {
      padding: 15px;
      background: rgba(30, 34, 40, 0.7);
      border-radius: 14px;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .metric-item:hover {
      background: rgba(40, 45, 55, 0.9);
      transform: translateY(-2px);
    }
    
    .metric-label {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 8px;
      display: block;
      line-height: 1.3;
    }
    
    .metric-value {
      font-size: 1.7rem;
      font-weight: 700;
      display: block;
    }
    
    .metric-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-top: 8px;
    }
    
    .badge-support {
      background: rgba(40, 167, 69, 0.15);
      color: var(--support-color);
      border: 1px solid var(--support-color);
    }
    
    .badge-resistance {
      background: rgba(220, 53, 69, 0.15);
      color: var(--resistance-color);
      border: 1px solid var(--resistance-color);
    }
    
    .badge-volume {
      background: rgba(88, 166, 255, 0.15);
      color: var(--volume-color);
      border: 1px solid var(--volume-color);
    }
    
    .badge-rsi {
      background: rgba(139, 92, 236, 0.15);
      color: #8b5cf6;
      border: 1px solid #8b5cf6;
    }
    
    .badge-macd {
      background: rgba(23, 162, 184, 0.15);
      color: var(--info);
      border: 1px solid var(--info);
    }
    
    .badge-macd.bullish {
      background: rgba(40, 167, 69, 0.2);
      color: var(--macd-bullish);
      border-color: var(--macd-bullish);
    }
    
    .badge-macd.bearish {
      background: rgba(220, 53, 69, 0.2);
      color: var(--macd-bearish);
      border-color: var(--macd-bearish);
    }
    
    .badge-bb {
      background: rgba(255, 107, 107, 0.15);
      color: var(--bb-upper);
      border: 1px solid var(--bb-upper);
    }
    
    .badge-bb.upper {
      background: rgba(255, 107, 107, 0.2);
      color: var(--bb-upper);
      border-color: var(--bb-upper);
    }
    
    .badge-bb.middle {
      background: rgba(88, 166, 255, 0.2);
      color: var(--bb-middle);
      border-color: var(--bb-middle);
    }
    
    .badge-bb.lower {
      background: rgba(40, 167, 69, 0.2);
      color: var(--bb-lower);
      border-color: var(--bb-lower);
    }
    
    .alert-container {
      grid-column: 1 / -1;
      background: rgba(30, 34, 40, 0.9);
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      margin-top: 10px;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      font-weight: 600;
      border: 2px solid transparent;
      transition: all 0.4s ease;
      line-height: 1.4;
    }
    
    .alert-container.buy {
      background: rgba(40, 167, 69, 0.1);
      border-color: var(--support-color);
      color: var(--support-color);
      box-shadow: 0 0 25px rgba(40, 167, 69, 0.2);
    }
    
    .alert-container.sell {
      background: rgba(220, 53, 69, 0.1);
      border-color: var(--resistance-color);
      color: var(--resistance-color);
      box-shadow: 0 0 25px rgba(220, 53, 69, 0.2);
    }
    
    .alert-container.none {
      background: rgba(108, 117, 125, 0.1);
      border-color: var(--text-secondary);
      color: var(--text-secondary);
    }
    
    .chart-container {
      grid-column: 2 / -1;
      background: var(--card-bg);
      border-radius: 20px;
      padding: 25px;
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      margin-top: 10px;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--border-color);
    }
    
    .chart-title {
      font-size: 1.7rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .chart-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .chart-tab {
      padding: 8px 16px;
      border-radius: 12px;
      background: rgba(30, 34, 40, 0.7);
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .chart-tab.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 15px rgba(88, 166, 255, 0.4);
    }
    
    .chart-wrapper {
      position: relative;
      height: 400px;
      width: 100%;
    }
    
    canvas {
      max-height: 400px;
    }
    
    .chart-legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.9rem;
    }
    
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }
    
    .footer {
      text-align: center;
      padding: 30px;
      margin-top: 20px;
      border-top: 1px solid var(--border-color);
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    .update-time {
      display: inline-block;
      background: rgba(88, 166, 255, 0.1);
      color: var(--primary);
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: 600;
      margin-top: 8px;
      font-size: 1.1rem;
    }
    
    .config-panel {
      background: var(--card-bg);
      border-radius: 20px;
      padding: 25px;
      margin: 25px 0;
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    }
    
    .config-title {
      font-size: 1.6rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .config-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }
    
    .config-item {
      margin-bottom: 15px;
    }
    
    .config-label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    
    .config-value {
      font-weight: 700;
      color: var(--primary);
      font-size: 1.3rem;
    }
    
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      font-size: 1.5rem;
      color: var(--text-secondary);
    }
    
    .loading-spinner {
      border: 4px solid rgba(88, 166, 255, 0.2);
      border-top: 4px solid var(--primary);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin-right: 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error-message {
      background: rgba(220, 53, 69, 0.1);
      border-left: 4px solid var(--resistance-color);
      padding: 15px;
      border-radius: 0 8px 8px 0;
      margin: 20px 0;
      color: var(--text-primary);
    }
    
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 15px 25px;
      box-shadow: 0 10px 35px rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
      animation: slideIn 0.3s forwards, slideOut 0.3s 2.7s forwards;
    }
    
    @keyframes slideIn {
      to { transform: translateX(0); }
    }
    
    @keyframes slideOut {
      to { transform: translateX(400px); }
    }
    
    .notification i {
      font-size: 1.8rem;
    }
    
    .notification.buy {
      border-left: 4px solid var(--support-color);
    }
    
    .notification.buy i {
      color: var(--support-color);
    }
    
    .notification.sell {
      border-left: 4px solid var(--resistance-color);
    }
    
    .notification.sell i {
      color: var(--resistance-color);
    }
    
    .strategy-info {
      background: rgba(23, 162, 184, 0.1);
      border-left: 4px solid var(--info);
      padding: 20px;
      border-radius: 0 12px 12px 0;
      margin: 25px 0;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    
    .strategy-info h3 {
      color: var(--info);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .strategy-info ul {
      padding-left: 20px;
      margin-top: 8px;
    }
    
    .strategy-info li {
      margin-bottom: 5px;
    }
    
    .timeframe-badge {
      display: inline-block;
      background: rgba(139, 92, 236, 0.2);
      color: #8b5cf6;
      padding: 2px 10px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .database-status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 600;
      margin-left: 10px;
      background: rgba(40, 167, 69, 0.15);
      color: var(--support-color);
      border: 1px solid var(--support-color);
    }
    
    .signal-history {
      margin-top: 25px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .history-item {
      padding: 12px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
    }
    
    .history-item:last-child {
      border-bottom: none;
    }
    
    .history-time {
      color: var(--text-secondary);
      font-size: 0.85rem;
    }
    
    .history-buy {
      color: var(--support-color);
    }
    
    .history-sell {
      color: var(--resistance-color);
    }
    
    .db-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(40, 167, 69, 0.15);
      color: var(--support-color);
      padding: 2px 10px;
      border-radius: 12px;
      font-size: 0.85rem;
      margin-left: 10px;
    }
    
    .bb-info {
      background: rgba(255, 107, 107, 0.1);
      border-left: 4px solid var(--bb-upper);
      padding: 15px;
      border-radius: 0 12px 12px 0;
      margin-top: 15px;
      font-size: 0.9rem;
    }
    
    .bb-info h4 {
      color: var(--bb-upper);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .chart-container {
        grid-column: 1 / -1;
      }
    }
    
    @media (max-width: 768px) {
      h1 {
        font-size: 2.7rem;
      }
      
      .subtitle {
        font-size: 1.15rem;
      }
      
      .price-display {
        font-size: 3.2rem;
      }
      
      .metric-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .card {
        padding: 22px;
      }
      
      .notification {
        top: 70px;
        right: 15px;
        width: calc(100% - 30px);
        text-align: center;
      }
      
      .chart-wrapper {
        height: 300px;
      }
      
      canvas {
        max-height: 300px;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 12px;
      }
      
      h1 {
        font-size: 2.3rem;
      }
      
      .subtitle {
        font-size: 1rem;
      }
      
      .price-display {
        font-size: 2.7rem;
      }
      
      .metric-grid {
        grid-template-columns: 1fr;
      }
      
      .metric-value {
        font-size: 1.6rem;
      }
      
      .card {
        padding: 18px;
      }
      
      .config-grid {
        grid-template-columns: 1fr;
      }
      
      .strategy-info {
        padding: 15px;
      }
      
      .chart-wrapper {
        height: 250px;
      }
      
      canvas {
        max-height: 250px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-crosshairs"></i> SOL Sniper PRO <span class="timeframe-badge">BB 1h + MACD 5m</span></h1>
      <div class="subtitle">
        Sistema avan√ßado com Bollinger Bands no timeframe de 1h e MACD no timeframe de 5m para timing preciso de entrada e sa√≠da
      </div>
      
      <div class="status-bar">
        <span class="status-indicator"></span>
        <span><strong>Conectado √† Binance API</strong> ‚Ä¢ Atualizando a cada 60 segundos <span class="db-status"><i class="fas fa-database"></i> IndexedDB</span></span>
      </div>
      
      <div class="strategy-info">
        <h3><i class="fas fa-brain"></i> Estrat√©gia de Trading com Bollinger Bands 1h + MACD 5m</h3>
        <p>Este sistema combina an√°lise de volatilidade no timeframe de <strong>1 hora</strong> com timing preciso de entrada e sa√≠da no timeframe de <strong>5 minutos</strong>:</p>
        <ul>
          <li><strong>üìà Bollinger Bands (1h):</strong> Identifica condi√ß√µes de sobrecompra (pre√ßo acima da banda superior) e sobrevenda (pre√ßo abaixo da banda inferior)</li>
          <li><strong>üïó Contexto 1h:</strong> Usa RSI e suporte/resist√™ncia para confirmar zonas de revers√£o</li>
          <li><strong>‚è±Ô∏è Timing 5m:</strong> Usa o MACD para confirmar o momento exato de entrada (crossover de alta) e sa√≠da (crossover de baixa)</li>
          <li><strong>üéØ Sinal de COMPRA:</strong> Pre√ßo abaixo da banda inferior BB 1h + RSI sobrevendido + MACD crossover de alta 5m</li>
          <li><strong>üéØ Sinal de VENDA:</strong> Pre√ßo acima da banda superior BB 1h + RSI sobrecomprado + MACD crossover de baixa 5m</li>
        </ul>
      </div>
    </header>
    
    <div class="config-panel">
      <div class="config-title">
        <i class="fas fa-cog"></i> Configura√ß√£o do Sistema
      </div>
      <div class="config-grid">
        <div class="config-item">
          <span class="config-label">Par Monitorado</span>
          <div class="config-value">SOL/USDT</div>
        </div>
        <div class="config-item">
          <span class="config-label">Contexto (TF)</span>
          <div class="config-value">1h <span class="timeframe-badge">BB (20,2)</span></div>
        </div>
        <div class="config-item">
          <span class="config-label">Timing (TF)</span>
          <div class="config-value">5m <span class="timeframe-badge">MACD (12,26,9)</span></div>
        </div>
        <div class="config-item">
          <span class="config-label">Per√≠odo RSI</span>
          <div class="config-value">14 velas</div>
        </div>
        <div class="config-item">
          <span class="config-label">BB Parameters</span>
          <div class="config-value">(20, 2)</div>
        </div>
        <div class="config-item">
          <span class="config-label">MACD Parameters</span>
          <div class="config-value">(12, 26, 9)</div>
        </div>
        <div class="config-item">
          <span class="config-label">Toler√¢ncia S/R</span>
          <div class="config-value">1.2%</div>
        </div>
        <div class="config-item">
          <span class="config-label">Threshold Volume</span>
          <div class="config-value">1.5x m√©dia</div>
        </div>
        <div class="config-item">
          <span class="config-label">√öltima Atualiza√ß√£o</span>
          <div class="config-value" id="last-update">Carregando...</div>
        </div>
      </div>
    </div>
    
    <div class="dashboard-grid">
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-coins"></i> Pre√ßo Atual
          </div>
          <div>
            <span class="metric-badge badge-rsi">SOL/USDT</span>
          </div>
        </div>
        <div class="price-display" id="current-price">
          <div class="loading">
            <div class="loading-spinner"></div>
            <span>Carregando pre√ßo...</span>
          </div>
        </div>
        <div class="alert-container none" id="alert-box">
          Aguardando an√°lise de mercado...
        </div>
        
        <div class="signal-history">
          <div style="font-weight: 600; margin-bottom: 15px; display: flex; justify-content: space-between;">
            <span><i class="fas fa-history"></i> Hist√≥rico de Sinais</span>
            <span class="metric-badge badge-rsi" id="signals-count">0 sinais</span>
          </div>
          <div id="history-list">
            <div class="history-item">
              <span>Nenhum sinal registrado ainda</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-chart-line"></i> Indicadores 1h
          </div>
        </div>
        <div class="metric-grid">
          <div class="metric-item">
            <span class="metric-label">RSI (14)</span>
            <span class="metric-value" id="rsi-value">--</span>
            <span class="metric-badge badge-rsi" id="rsi-status">Carregando...</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Volume</span>
            <span class="metric-value" id="volume-ratio">--</span>
            <span class="metric-badge badge-volume" id="volume-status">Carregando...</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">24h Alta</span>
            <span class="metric-value" id="high-24h">--</span>
            <span class="metric-badge badge-resistance">Resist√™ncia</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">24h Baixa</span>
            <span class="metric-value" id="low-24h">--</span>
            <span class="metric-badge badge-support">Suporte</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">BB Position</span>
            <span class="metric-value" id="bb-position">--</span>
            <span class="metric-badge badge-bb" id="bb-status">Carregando...</span>
          </div>
        </div>
        
        <div class="bb-info">
          <h4><i class="fas fa-chart-line"></i> Bollinger Bands 1h (20,2)</h4>
          <div style="display: flex; justify-content: space-between; margin-top: 8px;">
            <span>Superior:</span>
            <span id="bb-upper-value">--</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span>M√©dia (SMA):</span>
            <span id="bb-middle-value">--</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span>Inferior:</span>
            <span id="bb-lower-value">--</span>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-bullseye"></i> An√°lise 1h
          </div>
        </div>
        <div class="metric-grid">
          <div class="metric-item">
            <span class="metric-label">Dist. Suporte</span>
            <span class="metric-value" id="dist-support">--</span>
            <span class="metric-badge badge-support" id="support-status">Carregando...</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Dist. Resist√™ncia</span>
            <span class="metric-value" id="dist-resistance">--</span>
            <span class="metric-badge badge-resistance" id="resistance-status">Carregando...</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Sinal 1h</span>
            <span class="metric-value" id="current-signal">--</span>
            <span class="metric-badge" id="signal-badge">Aguardando</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">For√ßa Sinal</span>
            <span class="metric-value" id="signal-strength">--</span>
            <span class="metric-badge" id="strength-badge">--</span>
          </div>
        </div>
      </div>
      
      <div class="card macd-card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-stopwatch"></i> Timing 5m (MACD)
          </div>
        </div>
        <div class="metric-grid">
          <div class="metric-item">
            <span class="metric-label">MACD</span>
            <span class="metric-value" id="macd-value">--</span>
            <span class="metric-badge badge-macd" id="macd-status">Carregando...</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Signal Line</span>
            <span class="metric-value" id="signal-line-value">--</span>
            <span class="metric-badge badge-macd">9-per√≠odo</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Histograma</span>
            <span class="metric-value" id="histogram-value">--</span>
            <span class="metric-badge badge-macd" id="histogram-status">Carregando...</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Crossover</span>
            <span class="metric-value" id="crossover-type">--</span>
            <span class="metric-badge badge-macd" id="crossover-status">Aguardando</span>
          </div>
        </div>
      </div>
      
      <div class="card bb-card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-chart-line"></i> Bollinger Bands 1h
          </div>
        </div>
        <div class="metric-grid">
          <div class="metric-item">
            <span class="metric-label">Banda Superior</span>
            <span class="metric-value" id="bb-upper-display">--</span>
            <span class="metric-badge badge-bb upper">+2œÉ</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Banda M√©dia</span>
            <span class="metric-value" id="bb-middle-display">--</span>
            <span class="metric-badge badge-bb middle">SMA 20</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Banda Inferior</span>
            <span class="metric-value" id="bb-lower-display">--</span>
            <span class="metric-badge badge-bb lower">-2œÉ</span>
          </div>
          <div class="metric-item">
            <span class="metric-label">Banda Width</span>
            <span class="metric-value" id="bb-width">--</span>
            <span class="metric-badge badge-bb" id="bb-width-status">Carregando...</span>
          </div>
        </div>
      </div>
      
      <div class="chart-container">
        <div class="chart-header">
          <div class="chart-title">
            <i class="fas fa-chart-candlestick"></i> Gr√°ficos Interativos
          </div>
          <div>
            <span class="metric-badge badge-rsi">Binance API</span>
          </div>
        </div>
        
        <div class="chart-tabs">
          <button class="chart-tab active" data-tab="1h">üìà Gr√°fico 1h (BB + Pre√ßo)</button>
          <button class="chart-tab" data-tab="5m">‚è±Ô∏è Gr√°fico 5m (Timing)</button>
          <button class="chart-tab" data-tab="macd">üìä MACD 5m</button>
        </div>
        
        <div class="chart-wrapper">
          <canvas id="main-chart"></canvas>
        </div>
        
        <div class="chart-legend" id="chart-legend">
          <!-- Legend will be generated dynamically -->
        </div>
      </div>
    </div>
    
    <div class="footer">
      <p><i class="fas fa-robot"></i> SOL Sniper PRO v5.0 ‚Ä¢ Bollinger Bands 1h + MACD 5m + Banco de Dados Local</p>
      <p>Fonte de dados: Binance API ‚Ä¢ Atualiza√ß√£o autom√°tica a cada 60 segundos</p>
      <div class="update-time" id="next-update">Pr√≥xima atualiza√ß√£o em: 60s</div>
      <p style="margin-top: 12px; font-size: 0.9rem; opacity: 0.7;">
        <i class="fas fa-exclamation-triangle"></i> Este sistema √© para fins educacionais. Opere com responsabilidade e sempre use stop loss.
      </p>
    </div>
  </div>
  
  <div class="notification buy" id="notification" style="display: none;">
    <i class="fas fa-arrow-up"></i>
    <div>
      <div style="font-weight: 700; font-size: 1.1rem;">SINAL DE COMPRA</div>
      <div id="notification-message">SOL/USDT abaixo da banda inferior BB com RSI sobrevendido</div>
    </div>
  </div>
  
  <script>
    // Configura√ß√µes do sistema
    const CONFIG = {
      SYMBOL: 'SOLUSDT',
      INTERVAL_1H: '1h',
      INTERVAL_5M: '5m',
      RSI_PERIOD: 14,
      BB_PERIOD: 20,
      BB_STD_DEV: 2,
      MACD_FAST: 12,
      MACD_SLOW: 26,
      MACD_SIGNAL: 9,
      TOLERANCE: 1.2, // 1.2%
      VOLUME_THRESHOLD: 1.5, // 1.5x m√©dia
      UPDATE_INTERVAL: 60000, // 60 segundos
      CANDLES_LIMIT_1H: 100,
      CANDLES_LIMIT_5M: 100,
      DB_NAME: 'sol_sniper_db',
      DB_VERSION: 1
    };
    
    // Estado da aplica√ß√£o
    let lastUpdate = null;
    let nextUpdateTimer = null;
    let countdownInterval = null;
    let chart = null;
    let currentTab = '1h';
    let signalHistory = [];
    let priceHistory = [];
    let db = null;
    
    // Inicializar banco de dados IndexedDB
    function initDatabase() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(CONFIG.DB_NAME, CONFIG.DB_VERSION);
        
        request.onerror = (event) => {
          console.error('Erro ao abrir banco de dados:', event.target.error);
          reject(event.target.error);
        };
        
        request.onsuccess = (event) => {
          db = event.target.result;
          console.log('Banco de dados aberto com sucesso');
          loadHistory().then(resolve).catch(reject);
        };
        
        request.onupgradeneeded = (event) => {
          db = event.target.result;
          
          // Criar armazenamento para pre√ßos
          if (!db.objectStoreNames.contains('prices')) {
            const priceStore = db.createObjectStore('prices', { 
              keyPath: 'id',
              autoIncrement: true
            });
            priceStore.createIndex('timestamp', 'timestamp', { unique: false });
          }
          
          // Criar armazenamento para sinais
          if (!db.objectStoreNames.contains('signals')) {
            const signalStore = db.createObjectStore('signals', {
              keyPath: 'id',
              autoIncrement: true
            });
            signalStore.createIndex('timestamp', 'timestamp', { unique: false });
          }
          
          console.log('Banco de dados criado/atualizado');
        };
      });
    }
    
    // Carregar hist√≥rico do banco de dados
    async function loadHistory() {
      return new Promise((resolve, reject) => {
        if (!db) {
          signalHistory = [];
          priceHistory = [];
          resolve();
          return;
        }
        
        const tx = db.transaction(['signals', 'prices'], 'readonly');
        const signalsStore = tx.objectStore('signals');
        const pricesStore = tx.objectStore('prices');
        
        // Carregar sinais
        const signalsRequest = signalsStore.index('timestamp').openCursor(null, 'prev');
        signalHistory = [];
        signalsRequest.onsuccess = (event) => {
          const cursor = event.target.result;
          if (cursor) {
            signalHistory.push(cursor.value);
            if (signalHistory.length < 50) { // Limitar a 50 sinais
              cursor.continue();
            } else {
              cursor.advance(signalHistory.length); // Pular o resto
            }
          } else {
            // Carregar pre√ßos
            const pricesRequest = pricesStore.index('timestamp').openCursor(null, 'prev');
            priceHistory = [];
            pricesRequest.onsuccess = (event) => {
              const cursor = event.target.result;
              if (cursor) {
                priceHistory.push(cursor.value);
                if (priceHistory.length < 1000) { // Limitar a 1000 pre√ßos
                  cursor.continue();
                } else {
                  cursor.advance(priceHistory.length);
                }
              } else {
                console.log(`Carregado ${signalHistory.length} sinais e ${priceHistory.length} pre√ßos do banco de dados`);
                document.getElementById('signals-count').textContent = `${signalHistory.length} sinais`;
                renderSignalHistory();
                resolve();
              }
            };
            pricesRequest.onerror = reject;
          }
        };
        signalsRequest.onerror = reject;
      });
    }
    
    // Salvar sinal no banco de dados
    function saveSignal(signalData) {
      if (!db) return;
      
      const signal = {
        timestamp: new Date().toISOString(),
        price: signalData.price,
        signal: signalData.signal,
        strength: signalData.strength,
        rsi: signalData.rsi,
        macd: signalData.macd,
        bbPosition: signalData.bbPosition,
        type: signalData.signalType
      };
      
      const tx = db.transaction('signals', 'readwrite');
      const store = tx.objectStore('signals');
      store.add(signal);
      
      tx.oncomplete = () => {
        signalHistory.unshift(signal);
        if (signalHistory.length > 50) {
          signalHistory = signalHistory.slice(0, 50);
        }
        document.getElementById('signals-count').textContent = `${signalHistory.length} sinais`;
        renderSignalHistory();
        console.log('Sinal salvo no banco de dados');
      };
      
      tx.onerror = (event) => {
        console.error('Erro ao salvar sinal:', event.target.error);
      };
    }
    
    // Salvar pre√ßo no banco de dados
    function savePrice(price) {
      if (!db) return;
      
      const priceEntry = {
        timestamp: new Date().toISOString(),
        price: price
      };
      
      const tx = db.transaction('prices', 'readwrite');
      const store = tx.objectStore('prices');
      store.add(priceEntry);
      
      tx.oncomplete = () => {
        priceHistory.unshift(priceEntry);
        if (priceHistory.length > 1000) {
          priceHistory = priceHistory.slice(0, 1000);
        }
        console.log('Pre√ßo salvo no banco de dados');
      };
      
      tx.onerror = (event) => {
        console.error('Erro ao salvar pre√ßo:', event.target.error);
      };
    }
    
    // Renderizar hist√≥rico de sinais
    function renderSignalHistory() {
      const historyList = document.getElementById('history-list');
      
      if (signalHistory.length === 0) {
        historyList.innerHTML = `
          <div class="history-item">
            <span>Nenhum sinal registrado ainda</span>
          </div>
        `;
        return;
      }
      
      historyList.innerHTML = signalHistory.map(signal => {
        const time = new Date(signal.timestamp).toLocaleTimeString('pt-BR');
        const date = new Date(signal.timestamp).toLocaleDateString('pt-BR');
        const signalClass = signal.type === 'buy' ? 'history-buy' : 'history-sell';
        const signalIcon = signal.type === 'buy' ? '<i class="fas fa-arrow-up"></i>' : '<i class="fas fa-arrow-down"></i>';
        
        return `
          <div class="history-item">
            <div>
              <span class="${signalClass}">${signalIcon} ${signal.signal} (${signal.strength})</span>
              <div class="history-time">${date} ${time}</div>
            </div>
            <div>
              <span>$${signal.price.toFixed(2)}</span>
              <div class="history-time">RSI: ${signal.rsi.toFixed(1)} | BB: ${signal.bbPosition}</div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // Fun√ß√£o para buscar dados da Binance
    async function fetchCandles(symbol, interval, limit) {
      try {
        const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`Erro na API Binance: ${response.status}`);
        }
        
        const data = await response.json();
        return data.map(candle => ({
          timestamp: candle[0],
          open: parseFloat(candle[1]),
          high: parseFloat(candle[2]),
          low: parseFloat(candle[3]),
          close: parseFloat(candle[4]),
          volume: parseFloat(candle[5])
        }));
      } catch (error) {
        console.error('Erro ao buscar candles:', error);
        showError(`Falha ao buscar dados da Binance: ${error.message}`);
        return null;
      }
    }
    
    // Calcular RSI
    function calculateRSI(candles, period = 14) {
      if (candles.length < period + 1) return 50;
      
      let gains = 0;
      let losses = 0;
      
      for (let i = candles.length - period; i < candles.length; i++) {
        const diff = candles[i].close - candles[i - 1].close;
        if (diff >= 0) gains += diff;
        else losses -= diff;
      }
      
      const avgGain = gains / period;
      const avgLoss = losses / period;
      
      if (avgLoss === 0) return 100;
      
      const rs = avgGain / avgLoss;
      return 100 - (100 / (1 + rs));
    }
    
    // Calcular Bollinger Bands
    function calculateBollingerBands(candles, period = 20, stdDev = 2) {
      if (candles.length < period) {
        return { upper: [], middle: [], lower: [], width: [] };
      }
      
      const closes = candles.map(c => c.close);
      const upper = [];
      const middle = [];
      const lower = [];
      const width = [];
      
      for (let i = period - 1; i < candles.length; i++) {
        const slice = closes.slice(i - period + 1, i + 1);
        const sma = slice.reduce((sum, val) => sum + val, 0) / period;
        const variance = slice.reduce((sum, val) => sum + Math.pow(val - sma, 2), 0) / period;
        const std = Math.sqrt(variance);
        
        middle.push(sma);
        upper.push(sma + (stdDev * std));
        lower.push(sma - (stdDev * std));
        width.push(((upper[upper.length - 1] - lower[lower.length - 1]) / sma) * 100);
      }
      
      return { upper, middle, lower, width };
    }
    
    // Calcular suporte e resist√™ncia
    function calculateSupportResistance(candles, period = 24) {
      if (candles.length < period) {
        return { support: 0, resistance: 0, distanceToSupport: 0, distanceToResistance: 0 };
      }
      
      const recentCandles = candles.slice(-period);
      const support = Math.min(...recentCandles.map(c => c.low));
      const resistance = Math.max(...recentCandles.map(c => c.high));
      const currentPrice = candles[candles.length - 1].close;
      
      const distanceToSupport = ((currentPrice - support) / support) * 100;
      const distanceToResistance = ((resistance - currentPrice) / resistance) * 100;
      
      return {
        support,
        resistance,
        distanceToSupport,
        distanceToResistance,
        currentPrice
      };
    }
    
    // Analisar volume
    function analyzeVolume(candles, period = 24) {
      if (candles.length < period) {
        return { currentVolume: 0, avgVolume: 0, ratio: 1, status: 'unknown' };
      }
      
      const recentCandles = candles.slice(-period);
      const currentVolume = recentCandles[recentCandles.length - 1].volume;
      const totalVolume = recentCandles.reduce((sum, c) => sum + c.volume, 0);
      const avgVolume = totalVolume / period;
      const ratio = currentVolume / avgVolume;
      
      let status;
      if (ratio >= 2.0) status = 'Muito Alto';
      else if (ratio >= 1.5) status = 'Alto';
      else if (ratio >= 0.8) status = 'Normal';
      else status = 'Baixo';
      
      return { currentVolume, avgVolume, ratio, status };
    }
    
    // Calcular EMA (Exponential Moving Average)
    function calculateEMA(candles, period) {
      if (candles.length < period) return [];
      
      const k = 2 / (period + 1);
      const ema = [];
      
      // SMA inicial
      let sum = 0;
      for (let i = 0; i < period; i++) {
        sum += candles[i].close;
      }
      let sma = sum / period;
      ema.push(sma);
      
      // Calcular EMA para os candles restantes
      for (let i = period; i < candles.length; i++) {
        const currentClose = candles[i].close;
        const previousEMA = ema[ema.length - 1];
        const currentEMA = (currentClose * k) + (previousEMA * (1 - k));
        ema.push(currentEMA);
      }
      
      return ema;
    }
    
    // Calcular MACD
    function calculateMACD(candles, fastPeriod = 12, slowPeriod = 26, signalPeriod = 9) {
      if (candles.length < slowPeriod + signalPeriod) {
        return { macdLine: [], signalLine: [], histogram: [] };
      }
      
      // Calcular EMAs
      const fastEMA = calculateEMA(candles, fastPeriod);
      const slowEMA = calculateEMA(candles, slowPeriod);
      
      // Calcular MACD Line (apenas para candles onde ambas as EMAs existem)
      const macdLine = [];
      const startIndex = slowPeriod - fastPeriod;
      
      for (let i = startIndex; i < fastEMA.length; i++) {
        macdLine.push(fastEMA[i] - slowEMA[i - startIndex]);
      }
      
      // Calcular Signal Line (EMA do MACD Line)
      const signalLine = calculateEMA(
        macdLine.map((value, index) => ({ close: value })),
        signalPeriod
      );
      
      // Calcular Histograma
      const histogram = [];
      const signalStartIndex = signalPeriod - 1;
      
      for (let i = signalStartIndex; i < macdLine.length; i++) {
        histogram.push(macdLine[i] - signalLine[i - signalStartIndex]);
      }
      
      return {
        macdLine,
        signalLine,
        histogram,
        fastEMA,
        slowEMA
      };
    }
    
    // Analisar MACD para timing
    function analyzeMACD(macdData) {
      if (!macdData || macdData.histogram.length < 2) {
        return {
          macdValue: 0,
          signalLineValue: 0,
          histogramValue: 0,
          crossover: 'none',
          signal: 'neutral',
          strength: 0
        };
      }
      
      const macdLine = macdData.macdLine;
      const signalLine = macdData.signalLine;
      const histogram = macdData.histogram;
      
      // Pegar os √∫ltimos valores
      const currentMACD = macdLine[macdLine.length - 1];
      const currentSignal = signalLine[signalLine.length - 1];
      const currentHistogram = histogram[histogram.length - 1];
      const previousHistogram = histogram[histogram.length - 2];
      
      // Determinar crossover
      let crossover = 'none';
      let signal = 'neutral';
      let strength = Math.abs(currentHistogram) * 100; // For√ßa baseada no histograma
      
      // Crossover de alta (bullish)
      if (previousHistogram < 0 && currentHistogram >= 0) {
        crossover = 'bullish';
        signal = 'bullish';
      } 
      // Crossover de baixa (bearish)
      else if (previousHistogram > 0 && currentHistogram <= 0) {
        crossover = 'bearish';
        signal = 'bearish';
      }
      // Nenhum crossover, mas ainda em territ√≥rio
      else if (currentHistogram > 0) {
        signal = 'bullish';
      } else if (currentHistogram < 0) {
        signal = 'bearish';
      }
      
      return {
        macdValue: currentMACD,
        signalLineValue: currentSignal,
        histogramValue: currentHistogram,
        crossover,
        signal,
        strength: Math.min(Math.round(strength), 100) // Limitar a 100
      };
    }
    
    // Verificar sinais com Bollinger Bands
    function checkSignals(price, rsi, sr, volume, bbData, macdAnalysis) {
      const rsiOversold = rsi < 30;
      const rsiOverbought = rsi > 70;
      const nearSupport = sr.distanceToSupport <= CONFIG.TOLERANCE;
      const nearResistance = sr.distanceToResistance <= CONFIG.TOLERANCE;
      const highVolume = volume.ratio >= CONFIG.VOLUME_THRESHOLD;
      
      // Bollinger Bands analysis
      const lastUpper = bbData.upper[bbData.upper.length - 1];
      const lastLower = bbData.lower[bbData.lower.length - 1];
      const bbWidth = bbData.width[bbData.width.length - 1];
      
      const priceAboveUpperBB = price > lastUpper;
      const priceBelowLowerBB = price < lastLower;
      const bbWidthHigh = bbWidth > 10; // Banda larga indica alta volatilidade
      
      // MACD timing
      const macdBullish = macdAnalysis.signal === 'bullish' || macdAnalysis.crossover === 'bullish';
      const macdBearish = macdAnalysis.signal === 'bearish' || macdAnalysis.crossover === 'bearish';
      
      let signal = 'NEUTRO';
      let signalType = 'none';
      let strength = 'BAIXA';
      let strengthLevel = 0;
      let message = '';
      let macdConfirmation = false;
      let bbPosition = 'MIDDLE';
      
      // Determinar posi√ß√£o em rela√ß√£o √†s bandas
      if (priceAboveUpperBB) bbPosition = 'ABOVE_UPPER';
      else if (priceBelowLowerBB) bbPosition = 'BELOW_LOWER';
      else if (price > bbData.middle[bbData.middle.length - 1]) bbPosition = 'UPPER_HALF';
      else bbPosition = 'LOWER_HALF';
      
      // Sinal de compra - requer confirma√ß√£o MACD para sinal forte
      // Condi√ß√£o ideal: Pre√ßo abaixo da banda inferior + RSI sobrevendido + MACD crossover de alta
      if ((priceBelowLowerBB || nearSupport || rsiOversold) && macdBullish) {
        signal = 'COMPRA';
        signalType = 'buy';
        strengthLevel = (priceBelowLowerBB ? 1 : 0) + (rsiOversold ? 1 : 0) + (nearSupport ? 1 : 0) + (highVolume ? 1 : 0) + (macdBullish ? 1 : 0) + (bbWidthHigh ? 1 : 0);
        macdConfirmation = true;
        
        // Mensagem detalhada
        message = `SOL/USDT `;
        if (priceBelowLowerBB) message += `abaixo da banda inferior BB `;
        if (rsiOversold) message += `${priceBelowLowerBB ? 'com ' : ''}RSI sobrevendido `;
        if (macdBullish) message += `${(priceBelowLowerBB || rsiOversold) ? 'e ' : ''}MACD 5m confirma entrada`;
      } 
      // Sinal de venda - requer confirma√ß√£o MACD para sinal forte
      // Condi√ß√£o ideal: Pre√ßo acima da banda superior + RSI sobrecomprado + MACD crossover de baixa
      else if ((priceAboveUpperBB || nearResistance || rsiOverbought) && macdBearish) {
        signal = 'VENDA';
        signalType = 'sell';
        strengthLevel = (priceAboveUpperBB ? 1 : 0) + (rsiOverbought ? 1 : 0) + (nearResistance ? 1 : 0) + (highVolume ? 1 : 0) + (macdBearish ? 1 : 0) + (bbWidthHigh ? 1 : 0);
        macdConfirmation = true;
        
        // Mensagem detalhada
        message = `SOL/USDT `;
        if (priceAboveUpperBB) message += `acima da banda superior BB `;
        if (rsiOverbought) message += `${priceAboveUpperBB ? 'com ' : ''}RSI sobrecomprado `;
        if (macdBearish) message += `${(priceAboveUpperBB || rsiOverbought) ? 'e ' : ''}MACD 5m confirma sa√≠da`;
      }
      // Sinal fraco sem confirma√ß√£o MACD
      else if (priceBelowLowerBB || nearSupport || rsiOversold) {
        signal = 'COMPRA FRACA';
        signalType = 'buy';
        strengthLevel = (priceBelowLowerBB ? 1 : 0) + (rsiOversold ? 1 : 0) + (nearSupport ? 1 : 0) + (highVolume ? 1 : 0);
        message = `SOL/USDT abaixo da banda inferior BB ou pr√≥ximo do suporte (aguardar confirma√ß√£o MACD 5m)`;
      }
      else if (priceAboveUpperBB || nearResistance || rsiOverbought) {
        signal = 'VENDA FRACA';
        signalType = 'sell';
        strengthLevel = (priceAboveUpperBB ? 1 : 0) + (rsiOverbought ? 1 : 0) + (nearResistance ? 1 : 0) + (highVolume ? 1 : 0);
        message = `SOL/USDT acima da banda superior BB ou pr√≥ximo da resist√™ncia (aguardar confirma√ß√£o MACD 5m)`;
      }
      
      // Determinar for√ßa do sinal
      if (strengthLevel >= 4 && macdConfirmation) {
        strength = 'ALTA';
      } else if (strengthLevel >= 3) {
        strength = 'M√âDIA';
      } else if (strengthLevel >= 2) {
        strength = 'BAIXA';
      }
      
      return {
        signal,
        signalType,
        strength,
        strengthLevel,
        message,
        macdConfirmation,
        rsiOversold,
        rsiOverbought,
        nearSupport,
        nearResistance,
        highVolume,
        macdBullish,
        macdBearish,
        bbPosition,
        rsi,
        macd: macdAnalysis.macdValue,
        bbWidth
      };
    }
    
    // Formatar moeda
    function formatCurrency(value) {
      return value.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }
    
    // Formatar n√∫mero com sinal
    function formatNumberWithSign(value, decimals = 2) {
      const formatted = Math.abs(value).toFixed(decimals);
      return `${value >= 0 ? '+' : '-'}${formatted}`;
    }
    
    // Formatar tempo
    function formatTime(date) {
      return new Date(date).toLocaleString('pt-BR', {
        timeZone: 'America/Sao_Paulo',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }
    
    // Mostrar erro
    function showError(message) {
      const alertBox = document.getElementById('alert-box');
      alertBox.className = 'alert-container sell';
      alertBox.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
    }
    
    // Mostrar notifica√ß√£o
    function showNotification(message, type = 'buy') {
      const notification = document.getElementById('notification');
      notification.className = `notification ${type}`;
      document.getElementById('notification-message').textContent = message;
      notification.style.display = 'flex';
      
      // Esconder ap√≥s 3 segundos
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }
    
    // Criar gr√°fico de candles com Bollinger Bands
    function createCandlestickChart(canvasId, candles, title, macdData = null, bbData = null) {
      const ctx = document.getElementById(canvasId).getContext('2d');
      
      // Formatar dados para o gr√°fico
      const chartData = candles.map(candle => ({
        x: candle.timestamp,
        o: candle.open,
        h: candle.high,
        l: candle.low,
        c: candle.close
      }));
      
      // Destruir gr√°fico anterior se existir
      if (chart) {
        chart.destroy();
      }
      
      // Configurar legend
      const legendItems = [
        { color: 'rgba(40, 167, 69, 0.8)', label: 'Alta (Bullish)' },
        { color: 'rgba(220, 53, 69, 0.8)', label: 'Baixa (Bearish)' }
      ];
      
      // Se for gr√°fico MACD, adicionar legendas espec√≠ficas
      if (macdData) {
        legendItems.push(
          { color: 'rgba(52, 152, 219, 0.8)', label: 'MACD Line' },
          { color: 'rgba(231, 76, 60, 0.8)', label: 'Signal Line' },
          { color: 'rgba(142, 68, 173, 0.8)', label: 'Histograma' }
        );
      } 
      // Se for gr√°fico com Bollinger Bands, adicionar legendas
      else if (bbData) {
        legendItems.push(
          { color: 'var(--bb-upper)', label: 'Banda Superior (+2œÉ)' },
          { color: 'var(--bb-middle)', label: 'Banda M√©dia (SMA 20)' },
          { color: 'var(--bb-lower)', label: 'Banda Inferior (-2œÉ)' }
        );
      }
      
      // Renderizar legend
      const legendContainer = document.getElementById('chart-legend');
      legendContainer.innerHTML = legendItems.map(item => `
        <div class="legend-item">
          <div class="legend-color" style="background-color: ${item.color}"></div>
          <span>${item.label}</span>
        </div>
      `).join('');
      
      // Configurar gr√°fico
      if (macdData) {
        // Gr√°fico MACD - combina√ß√£o de linhas e barras
        const macdLineData = macdData.macdLine.map((value, index) => ({
          x: candles[index + 26].timestamp, // Ajustar pelo per√≠odo lento
          y: value
        }));
        
        const signalLineData = macdData.signalLine.map((value, index) => ({
          x: candles[index + 34].timestamp, // Ajustar pelo per√≠odo lento + sinal
          y: value
        }));
        
        const histogramData = macdData.histogram.map((value, index) => ({
          x: candles[index + 34].timestamp,
          y: value
        }));
        
        chart = new Chart(ctx, {
          type: 'bar',
           {
            datasets: [
              {
                type: 'line',
                label: 'MACD Line',
                 macdLineData,
                borderColor: 'rgba(52, 152, 219, 0.8)',
                backgroundColor: 'transparent',
                borderWidth: 2,
                pointRadius: 0,
                fill: false
              },
              {
                type: 'line',
                label: 'Signal Line',
                 signalLineData,
                borderColor: 'rgba(231, 76, 60, 0.8)',
                backgroundColor: 'transparent',
                borderWidth: 2,
                pointRadius: 0,
                fill: false
              },
              {
                type: 'bar',
                label: 'Histograma',
                 histogramData,
                backgroundColor: function(context) {
                  const value = context.raw.y;
                  return value >= 0 ? 
                    'rgba(40, 167, 69, 0.6)' : // Verde para positivo
                    'rgba(220, 53, 69, 0.6)'; // Vermelho para negativo
                },
                borderWidth: 0
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                mode: 'index',
                intersect: false
              }
            },
            scales: {
              x: {
                type: 'time',
                time: {
                  unit: 'minute',
                  displayFormats: {
                    minute: 'HH:mm'
                  }
                },
                grid: {
                  color: 'rgba(34, 40, 51, 0.5)'
                },
                ticks: {
                  color: '#8b949e'
                }
              },
              y: {
                grid: {
                  color: 'rgba(34, 40, 51, 0.5)'
                },
                ticks: {
                  color: '#8b949e'
                }
              }
            }
          }
        });
      } else {
        // Gr√°fico de candles com Bollinger Bands (se dispon√≠vel)
        const datasets = [{
          label: title,
          type: 'candlestick',
           chartData,
          borderColor: function(context) {
            const candle = context.raw;
            return candle.c >= candle.o ? 
              'rgba(40, 167, 69, 0.8)' : // Verde para alta
              'rgba(220, 53, 69, 0.8)'; // Vermelho para baixa
          },
          backgroundColor: function(context) {
            const candle = context.raw;
            return candle.c >= candle.o ? 
              'rgba(40, 167, 69, 0.2)' : // Verde claro para alta
              'rgba(220, 53, 69, 0.2)'; // Vermelho claro para baixa
          },
          borderWidth: 1,
          hoverBorderColor: 'white'
        }];
        
        // Adicionar Bollinger Bands se dispon√≠vel
        if (bbData && bbData.upper.length > 0) {
          // Ajustar os dados das bandas para corresponder aos candles exibidos
          const bbStartIndex = candles.length - bbData.upper.length;
          
          // Banda Superior
          datasets.push({
            label: 'Banda Superior',
            type: 'line',
             bbData.upper.map((value, index) => ({
              x: candles[bbStartIndex + index].timestamp,
              y: value
            })),
            borderColor: 'var(--bb-upper)',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 0,
            fill: false,
            tension: 0.1
          });
          
          // Banda M√©dia (SMA)
          datasets.push({
            label: 'Banda M√©dia',
            type: 'line',
             bbData.middle.map((value, index) => ({
              x: candles[bbStartIndex + index].timestamp,
              y: value
            })),
            borderColor: 'var(--bb-middle)',
            backgroundColor: 'transparent',
            borderWidth: 2,
            borderDash: [5, 5],
            pointRadius: 0,
            fill: false,
            tension: 0.1
          });
          
          // Banda Inferior
          datasets.push({
            label: 'Banda Inferior',
            type: 'line',
             bbData.lower.map((value, index) => ({
              x: candles[bbStartIndex + index].timestamp,
              y: value
            })),
            borderColor: 'var(--bb-lower)',
            backgroundColor: 'transparent',
            borderWidth: 2,
            pointRadius: 0,
            fill: {
              target: '-1',
              above: 'rgba(40, 167, 69, 0.1)',
              below: 'rgba(255, 107, 107, 0.1)'
            },
            tension: 0.1
          });
        }
        
        chart = new Chart(ctx, {
          type: 'bar',
           {
            datasets: datasets
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              tooltip: {
                mode: 'index',
                intersect: false,
                callbacks: {
                  label: function(context) {
                    if (context.dataset.type === 'candlestick') {
                      const candle = context.raw;
                      return [
                        `Abertura: $${candle.o.toFixed(2)}`,
                        `M√°xima: $${candle.h.toFixed(2)}`,
                        `M√≠nima: $${candle.l.toFixed(2)}`,
                        `Fechamento: $${candle.c.toFixed(2)}`
                      ];
                    }
                    return `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`;
                  }
                }
              }
            },
            scales: {
              x: {
                type: 'time',
                time: {
                  unit: currentTab === '1h' ? 'hour' : 'minute',
                  displayFormats: {
                    hour: 'HH:mm',
                    minute: 'HH:mm'
                  }
                },
                grid: {
                  color: 'rgba(34, 40, 51, 0.5)'
                },
                ticks: {
                  color: '#8b949e'
                }
              },
              y: {
                grid: {
                  color: 'rgba(34, 40, 51, 0.5)'
                },
                ticks: {
                  color: '#8b949e'
                }
              }
            }
          }
        });
      }
    }
    
    // Atualizar dashboard
    async function updateDashboard() {
      try {
        // Mostrar loading
        document.getElementById('current-price').innerHTML = `
          <div class="loading">
            <div class="loading-spinner"></div>
            <span>Atualizando dados...</span>
          </div>
        `;
        
        // Buscar dados 1h
        const candles1h = await fetchCandles(CONFIG.SYMBOL, CONFIG.INTERVAL_1H, CONFIG.CANDLES_LIMIT_1H);
        if (!candles1h || candles1h.length === 0) {
          throw new Error('Nenhum dado 1h recebido da Binance');
        }
        
        // Buscar dados 5m para MACD
        const candles5m = await fetchCandles(CONFIG.SYMBOL, CONFIG.INTERVAL_5M, CONFIG.CANDLES_LIMIT_5M);
        if (!candles5m || candles5m.length === 0) {
          throw new Error('Nenhum dado 5m recebido da Binance');
        }
        
        // Processar dados 1h
        const lastCandle1h = candles1h[candles1h.length - 1];
        const currentPrice = lastCandle1h.close;
        const rsi = calculateRSI(candles1h, CONFIG.RSI_PERIOD);
        const sr = calculateSupportResistance(candles1h, 24);
        const volume = analyzeVolume(candles1h, 24);
        
        // Calcular Bollinger Bands para 1h
        const bbData1h = calculateBollingerBands(candles1h, CONFIG.BB_PERIOD, CONFIG.BB_STD_DEV);
        const lastUpperBB = bbData1h.upper[bbData1h.upper.length - 1];
        const lastMiddleBB = bbData1h.middle[bbData1h.middle.length - 1];
        const lastLowerBB = bbData1h.lower[bbData1h.lower.length - 1];
        const lastBBWidth = bbData1h.width[bbData1h.width.length - 1];
        
        // Processar MACD 5m
        const macdData = calculateMACD(candles5m, CONFIG.MACD_FAST, CONFIG.MACD_SLOW, CONFIG.MACD_SIGNAL);
        const macdAnalysis = analyzeMACD(macdData);
        
        // Verificar sinais combinando 1h e 5m com BB
        const signals = checkSignals(currentPrice, rsi, sr, volume, bbData1h, macdAnalysis);
        
        // Salvar pre√ßo no banco de dados local
        savePrice(currentPrice);
        
        // Salvar sinal se for forte e novo
        const lastStrongSignal = signalHistory.find(s => 
          s.signal.includes('COMPRA') || s.signal.includes('VENDA')
        );
        
        const isStrongSignal = signals.strength === 'ALTA' && signals.macdConfirmation;
        const isDifferentFromLast = !lastStrongSignal || 
          (lastStrongSignal.signal.includes('COMPRA') && signals.signal.includes('VENDA')) ||
          (lastStrongSignal.signal.includes('VENDA') && signals.signal.includes('COMPRA'));
        
        if (isStrongSignal && isDifferentFromLast) {
          saveSignal({
            price: currentPrice,
            signal: signals.signal,
            strength: signals.strength,
            rsi: rsi,
            macd: macdAnalysis.macdValue,
            bbPosition: signals.bbPosition,
            signalType: signals.signalType
          });
          
          // Mostrar notifica√ß√£o
          showNotification(signals.message, signals.signalType);
        }
        
        // Atualizar elementos do DOM - Pre√ßo e indicadores 1h
        document.getElementById('current-price').textContent = formatCurrency(currentPrice);
        document.getElementById('rsi-value').textContent = rsi.toFixed(2);
        document.getElementById('volume-ratio').textContent = volume.ratio.toFixed(2) + 'x';
        document.getElementById('high-24h').textContent = '$' + formatCurrency(sr.resistance);
        document.getElementById('low-24h').textContent = '$' + formatCurrency(sr.support);
        document.getElementById('dist-support').textContent = sr.distanceToSupport.toFixed(2) + '%';
        document.getElementById('dist-resistance').textContent = sr.distanceToResistance.toFixed(2) + '%';
        document.getElementById('current-signal').textContent = signals.signal;
        document.getElementById('signal-strength').textContent = signals.strength;
        
        // Atualizar Bollinger Bands
        document.getElementById('bb-upper-value').textContent = '$' + formatCurrency(lastUpperBB);
        document.getElementById('bb-middle-value').textContent = '$' + formatCurrency(lastMiddleBB);
        document.getElementById('bb-lower-value').textContent = '$' + formatCurrency(lastLowerBB);
        document.getElementById('bb-upper-display').textContent = '$' + formatCurrency(lastUpperBB);
        document.getElementById('bb-middle-display').textContent = '$' + formatCurrency(lastMiddleBB);
        document.getElementById('bb-lower-display').textContent = '$' + formatCurrency(lastLowerBB);
        document.getElementById('bb-width').textContent = lastBBWidth.toFixed(2) + '%';
        
        // Atualizar posi√ß√£o BB
        const bbPositionEl = document.getElementById('bb-position');
        const bbStatusEl = document.getElementById('bb-status');
        const bbWidthStatusEl = document.getElementById('bb-width-status');
        
        if (currentPrice > lastUpperBB) {
          bbPositionEl.textContent = 'ACIMA SUPERIOR';
          bbStatusEl.textContent = 'Sobrecompra';
          bbStatusEl.className = 'metric-badge badge-bb upper';
          bbWidthStatusEl.textContent = lastBBWidth > 10 ? 'Alta Volat.' : 'Normal';
          bbWidthStatusEl.className = 'metric-badge badge-bb ' + (lastBBWidth > 10 ? 'upper' : '');
        } else if (currentPrice < lastLowerBB) {
          bbPositionEl.textContent = 'ABAIXO INFERIOR';
          bbStatusEl.textContent = 'Sobrevenda';
          bbStatusEl.className = 'metric-badge badge-bb lower';
          bbWidthStatusEl.textContent = lastBBWidth > 10 ? 'Alta Volat.' : 'Normal';
          bbWidthStatusEl.className = 'metric-badge badge-bb ' + (lastBBWidth > 10 ? 'lower' : '');
        } else if (currentPrice > lastMiddleBB) {
          bbPositionEl.textContent = 'MEIO SUPERIOR';
          bbStatusEl.textContent = 'Neutro';
          bbStatusEl.className = 'metric-badge badge-bb middle';
          bbWidthStatusEl.textContent = lastBBWidth > 10 ? 'Alta Volat.' : 'Normal';
          bbWidthStatusEl.className = 'metric-badge badge-bb';
        } else {
          bbPositionEl.textContent = 'MEIO INFERIOR';
          bbStatusEl.textContent = 'Neutro';
          bbStatusEl.className = 'metric-badge badge-bb middle';
          bbWidthStatusEl.textContent = lastBBWidth > 10 ? 'Alta Volat.' : 'Normal';
          bbWidthStatusEl.className = 'metric-badge badge-bb';
        }
        
        // Atualizar status RSI
        const rsiStatusEl = document.getElementById('rsi-status');
        if (rsi < 30) {
          rsiStatusEl.textContent = 'Sobrevendido';
          rsiStatusEl.className = 'metric-badge badge-rsi';
          rsiStatusEl.style.color = 'var(--rsi-oversold)';
        } else if (rsi > 70) {
          rsiStatusEl.textContent = 'Sobrecomprado';
          rsiStatusEl.className = 'metric-badge badge-rsi';
          rsiStatusEl.style.color = 'var(--rsi-overbought)';
        } else {
          rsiStatusEl.textContent = 'Neutro';
          rsiStatusEl.className = 'metric-badge badge-rsi';
          rsiStatusEl.style.color = 'var(--rsi-neutral)';
        }
        
        // Atualizar status Volume
        const volumeStatusEl = document.getElementById('volume-status');
        volumeStatusEl.textContent = volume.status;
        if (volume.ratio >= 1.5) {
          volumeStatusEl.className = 'metric-badge badge-volume';
        } else {
          volumeStatusEl.className = 'metric-badge badge-volume';
          volumeStatusEl.style.opacity = '0.7';
        }
        
        // Atualizar status Suporte
        const supportStatusEl = document.getElementById('support-status');
        supportStatusEl.textContent = sr.distanceToSupport <= CONFIG.TOLERANCE ? 'PR√ìXIMO' : 'Distante';
        supportStatusEl.className = sr.distanceToSupport <= CONFIG.TOLERANCE ? 
          'metric-badge badge-support' : 'metric-badge badge-support';
        
        // Atualizar status Resist√™ncia
        const resistanceStatusEl = document.getElementById('resistance-status');
        resistanceStatusEl.textContent = sr.distanceToResistance <= CONFIG.TOLERANCE ? 'PR√ìXIMO' : 'Distante';
        resistanceStatusEl.className = sr.distanceToResistance <= CONFIG.TOLERANCE ? 
          'metric-badge badge-resistance' : 'metric-badge badge-resistance';
        
        // Atualizar badge de sinal
        const signalBadgeEl = document.getElementById('signal-badge');
        const strengthBadgeEl = document.getElementById('strength-badge');
        
        if (signals.signal.includes('COMPRA')) {
          signalBadgeEl.textContent = signals.signal.includes('FRACA') ? 'LONG FRACO' : 'LONG';
          signalBadgeEl.className = 'metric-badge badge-support';
          signalBadgeEl.style.backgroundColor = 'rgba(40, 167, 69, 0.2)';
          
          strengthBadgeEl.textContent = signals.strength;
          strengthBadgeEl.className = 'metric-badge';
          strengthBadgeEl.style.backgroundColor = signals.strength === 'ALTA' ? 
            'rgba(40, 167, 69, 0.3)' : (signals.strength === 'M√âDIA' ? 'rgba(255, 193, 7, 0.2)' : 'rgba(108, 117, 125, 0.2)');
          strengthBadgeEl.style.color = signals.strength === 'ALTA' ? 'var(--success)' : 
            (signals.strength === 'M√âDIA' ? 'var(--warning)' : 'var(--text-secondary)');
        } else if (signals.signal.includes('VENDA')) {
          signalBadgeEl.textContent = signals.signal.includes('FRACA') ? 'SHORT FRACO' : 'SHORT';
          signalBadgeEl.className = 'metric-badge badge-resistance';
          signalBadgeEl.style.backgroundColor = 'rgba(220, 53, 69, 0.2)';
          
          strengthBadgeEl.textContent = signals.strength;
          strengthBadgeEl.className = 'metric-badge';
          strengthBadgeEl.style.backgroundColor = signals.strength === 'ALTA' ? 
            'rgba(220, 53, 69, 0.3)' : (signals.strength === 'M√âDIA' ? 'rgba(255, 193, 7, 0.2)' : 'rgba(108, 117, 125, 0.2)');
          strengthBadgeEl.style.color = signals.strength === 'ALTA' ? 'var(--danger)' : 
            (signals.strength === 'M√âDIA' ? 'var(--warning)' : 'var(--text-secondary)');
        } else {
          signalBadgeEl.textContent = 'ESPERAR';
          signalBadgeEl.className = 'metric-badge';
          signalBadgeEl.style.backgroundColor = 'rgba(108, 117, 125, 0.2)';
          signalBadgeEl.style.color = 'var(--text-secondary)';
          
          strengthBadgeEl.textContent = '-';
          strengthBadgeEl.className = 'metric-badge';
          strengthBadgeEl.style.backgroundColor = 'rgba(108, 117, 125, 0.2)';
        }
        
        // Atualizar indicadores MACD 5m
        document.getElementById('macd-value').textContent = macdAnalysis.macdValue.toFixed(4);
        document.getElementById('signal-line-value').textContent = macdAnalysis.signalLineValue.toFixed(4);
        document.getElementById('histogram-value').textContent = formatNumberWithSign(macdAnalysis.histogramValue, 6);
        
        // Atualizar status MACD
        const macdStatusEl = document.getElementById('macd-status');
        const histogramStatusEl = document.getElementById('histogram-status');
        const crossoverTypeEl = document.getElementById('crossover-type');
        const crossoverStatusEl = document.getElementById('crossover-status');
        
        // Status do MACD
        if (macdAnalysis.signal === 'bullish') {
          macdStatusEl.textContent = 'Bullish';
          macdStatusEl.className = 'metric-badge badge-macd bullish';
        } else if (macdAnalysis.signal === 'bearish') {
          macdStatusEl.textContent = 'Bearish';
          macdStatusEl.className = 'metric-badge badge-macd bearish';
        } else {
          macdStatusEl.textContent = 'Neutral';
          macdStatusEl.className = 'metric-badge badge-macd';
        }
        
        // Status do Histograma
        if (macdAnalysis.histogramValue > 0) {
          histogramStatusEl.textContent = 'Acima Zero';
          histogramStatusEl.className = 'metric-badge badge-macd bullish';
        } else if (macdAnalysis.histogramValue < 0) {
          histogramStatusEl.textContent = 'Abaixo Zero';
          histogramStatusEl.className = 'metric-badge badge-macd bearish';
        } else {
          histogramStatusEl.textContent = 'Zero';
          histogramStatusEl.className = 'metric-badge badge-macd';
        }
        
        // Status do Crossover
        if (macdAnalysis.crossover === 'bullish') {
          crossoverTypeEl.textContent = 'ALTA';
          crossoverStatusEl.textContent = 'CONFIRMADO';
          crossoverStatusEl.className = 'metric-badge badge-macd bullish';
        } else if (macdAnalysis.crossover === 'bearish') {
          crossoverTypeEl.textContent = 'BAIXA';
          crossoverStatusEl.textContent = 'CONFIRMADO';
          crossoverStatusEl.className = 'metric-badge badge-macd bearish';
        } else {
          crossoverTypeEl.textContent = '---';
          crossoverStatusEl.textContent = 'Aguardando';
          crossoverStatusEl.className = 'metric-badge badge-macd';
        }
        
        // Atualizar alerta principal
        const alertBox = document.getElementById('alert-box');
        
        if (signals.signal.includes('COMPRA')) {
          alertBox.className = 'alert-container buy';
          alertBox.innerHTML = `
            <i class="fas fa-arrow-up"></i> ${signals.message}
            ${signals.macdConfirmation ? '<br><small style="opacity:0.8">‚úÖ Timing de entrada confirmado pelo MACD 5m</small>' : ''}
            ${signals.bbPosition === 'BELOW_LOWER' ? '<br><small style="opacity:0.8">üìà Pre√ßo abaixo da banda inferior BB 1h (sobrevenda)</small>' : ''}
          `;
        } else if (signals.signal.includes('VENDA')) {
          alertBox.className = 'alert-container sell';
          alertBox.innerHTML = `
            <i class="fas fa-arrow-down"></i> ${signals.message}
            ${signals.macdConfirmation ? '<br><small style="opacity:0.8">‚úÖ Timing de sa√≠da confirmado pelo MACD 5m</small>' : ''}
            ${signals.bbPosition === 'ABOVE_UPPER' ? '<br><small style="opacity:0.8">üìâ Pre√ßo acima da banda superior BB 1h (sobrecompra)</small>' : ''}
          `;
        } else {
          alertBox.className = 'alert-container none';
          alertBox.textContent = 'Nenhum sinal forte no momento. Aguardando confirma√ß√£o de ambos timeframes.';
        }
        
        // Atualizar gr√°ficos com base na aba ativa
        if (currentTab === '1h') {
          createCandlestickChart('main-chart', candles1h.slice(-50), 'SOL/USDT 1h', null, bbData1h);
        } else if (currentTab === '5m') {
          createCandlestickChart('main-chart', candles5m.slice(-50), 'SOL/USDT 5m');
        } else if (currentTab === 'macd') {
          createCandlestickChart('main-chart', candles5m.slice(-50), 'MACD 5m', macdData);
        }
        
        // Atualizar hor√°rios
        lastUpdate = new Date();
        document.getElementById('last-update').textContent = formatTime(lastUpdate);
        
        // Resetar contador
        if (countdownInterval) clearInterval(countdownInterval);
        let secondsLeft = Math.floor(CONFIG.UPDATE_INTERVAL / 1000);
        document.getElementById('next-update').textContent = `Pr√≥xima atualiza√ß√£o em: ${secondsLeft}s`;
        
        countdownInterval = setInterval(() => {
          secondsLeft--;
          document.getElementById('next-update').textContent = `Pr√≥xima atualiza√ß√£o em: ${secondsLeft}s`;
          if (secondsLeft <= 0) secondsLeft = Math.floor(CONFIG.UPDATE_INTERVAL / 1000);
        }, 1000);
        
        console.log('Dashboard atualizado com sucesso:', formatTime(lastUpdate));
        console.log('BB Position:', signals.bbPosition, '| MACD 5m:', macdAnalysis.signal, '| Crossover:', macdAnalysis.crossover);
        
      } catch (error) {
        console.error('Erro ao atualizar dashboard:', error);
        showError(`Erro ao atualizar dados: ${error.message || 'Verifique sua conex√£o com a internet'}`);
        
        // Manter √∫ltimo pre√ßo se houver
        if (document.getElementById('current-price').textContent.includes('Carregando')) {
          document.getElementById('current-price').textContent = '$ --.--';
        }
      }
    }
    
    // Inicializar dashboard
    async function initDashboard() {
      console.log('Iniciando SOL Sniper PRO Dashboard com Bollinger Bands 1h e MACD 5m...');
      
      // Inicializar banco de dados
      try {
        await initDatabase();
        console.log('Banco de dados inicializado com sucesso');
      } catch (error) {
        console.error('Erro ao inicializar banco de dados:', error);
        document.querySelector('.db-status').innerHTML = '<i class="fas fa-exclamation-triangle"></i> Erro DB';
        document.querySelector('.db-status').style.backgroundColor = 'rgba(220, 53, 69, 0.15)';
        document.querySelector('.db-status').style.color = 'var(--resistance-color)';
      }
      
      // Configurar tabs dos gr√°ficos
      document.querySelectorAll('.chart-tab').forEach(tab => {
        tab.addEventListener('click', () => {
          // Remover classe active de todos os tabs
          document.querySelectorAll('.chart-tab').forEach(t => t.classList.remove('active'));
          // Adicionar classe active ao tab clicado
          tab.classList.add('active');
          // Atualizar aba ativa
          currentTab = tab.dataset.tab;
          // Atualizar gr√°fico
          updateDashboard();
        });
      });
      
      // Primeira atualiza√ß√£o imediata
      await updateDashboard();
      
      // Agendar pr√≥ximas atualiza√ß√µes
      nextUpdateTimer = setInterval(updateDashboard, CONFIG.UPDATE_INTERVAL);
      
      // Adicionar evento de clique para atualiza√ß√£o manual
      document.getElementById('current-price').addEventListener('click', () => {
        console.log('Atualiza√ß√£o manual solicitada');
        updateDashboard();
        
        // Feedback visual
        const priceEl = document.getElementById('current-price');
        const originalText = priceEl.textContent;
        priceEl.textContent = 'üîÑ Atualizando...';
        setTimeout(() => {
          if (priceEl.textContent === 'üîÑ Atualizando...') {
            priceEl.textContent = originalText;
          }
        }, 2000);
      });
      
      // Mensagem de boas-vindas no console
      console.log('%cüéØ SOL Sniper PRO com Bollinger Bands 1h e MACD 5m Iniciado!', 'color: #58a6ff; font-size: 20px; font-weight: bold;');
      console.log(`%cDados sendo atualizados a cada ${CONFIG.UPDATE_INTERVAL / 1000} segundos`, 'color: #8b949e; font-size: 14px;');
      console.log('%cFonte: Binance API (https://api.binance.com)', 'color: #28a745; font-size: 14px;');
      console.log('%cEstrat√©gia: BB 1h (20,2) + MACD 5m (12,26,9)', 'color: #ffc107; font-size: 14px;');
      console.log('%cBanco de Dados: Armazenamento local via IndexedDB', 'color: #17a2b8; font-size: 14px;');
    }
    
    // Iniciar quando a p√°gina carregar
    window.addEventListener('DOMContentLoaded', initDashboard);
    
    // Tratar visibilidade da p√°gina (pausar quando em background)
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        console.log('P√°gina em background - pausando atualiza√ß√µes');
        if (nextUpdateTimer) clearInterval(nextUpdateTimer);
        if (countdownInterval) clearInterval(countdownInterval);
      } else {
        console.log('P√°gina em foco - retomando atualiza√ß√µes');
        if (nextUpdateTimer) clearInterval(nextUpdateTimer);
        if (countdownInterval) clearInterval(countdownInterval);
        updateDashboard();
        nextUpdateTimer = setInterval(updateDashboard, CONFIG.UPDATE_INTERVAL);
      }
    });
  </script>
</body>
</html>

