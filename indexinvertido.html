<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOL Sniper PRO - Multi-Timeframe MACD 1h</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0d1117 0%, #111827 100%);
      color: #c9d1d9;
      margin: 0;
      padding: 20px;
      min-height: 100vh;
      transition: background 0.5s ease;
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      padding: 30px 0;
      margin-bottom: 30px;
    }
    
    h1 {
      font-size: 3.8rem;
      margin-bottom: 15px;
      background: linear-gradient(90deg, #58a6ff, #8a6bff, #28a745, #17a2b8, #ff9800);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 25px rgba(88, 166, 255, 0.4);
      letter-spacing: -0.5px;
    }
    
    .subtitle {
      font-size: 1.5rem;
      color: #8b949e;
      margin-top: 15px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.6;
    }
    
    .status-bar {
      background: rgba(22, 27, 34, 0.8);
      border-radius: 50px;
      padding: 12px 30px;
      display: inline-flex;
      align-items: center;
      margin: 25px auto;
      border: 1px solid #30363d;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      animation: fadeIn 0.5s ease-out;
    }
    
    .status-indicator {
      display: inline-block;
      width: 14px;
      height: 14px;
      background: #28a745;
      border-radius: 50%;
      margin-right: 10px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4); }
      70% { opacity: 0.7; box-shadow: 0 0 0 8px rgba(40, 167, 69, 0); }
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }
    
    .card {
      background: #161b22;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4),
                  0 0 30px rgba(88, 166, 255, 0.08);
      padding: 28px;
      border: 1px solid #30363d;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
      animation: slideUp 0.6s ease-out forwards;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, #58a6ff, #28a745, #17a2b8);
      opacity: 0.7;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5),
                  0 0 40px rgba(88, 166, 255, 0.15);
    }
    
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 22px;
      padding-bottom: 15px;
      border-bottom: 1px solid #30363d;
    }
    
    .card-title {
      font-size: 1.6rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .card-title i {
      font-size: 1.8rem;
    }
    
    .price-display {
      font-size: 4.5rem;
      font-weight: 800;
      text-align: center;
      margin: 25px 0;
      background: linear-gradient(90deg, #28a745, #34d399, #58a6ff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 15px rgba(40, 167, 69, 0.3);
      position: relative;
      line-height: 1;
    }
    
    .price-display::after {
      content: 'R$';
      position: absolute;
      left: -35px;
      top: 0;
      font-size: 0.6em;
      opacity: 0.7;
    }
    
    .price-display small {
      font-size: 1.2rem;
      font-weight: 400;
      color: #8b949e;
      margin-left: 8px;
    }
    
    .metric-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 18px;
      margin-top: 15px;
    }
    
    .metric-item {
      padding: 15px;
      background: rgba(30, 34, 40, 0.7);
      border-radius: 14px;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .metric-item:hover {
      background: rgba(40, 45, 55, 0.9);
      transform: translateY(-2px);
    }
    
    .metric-label {
      font-size: 0.9rem;
      color: #8b949e;
      margin-bottom: 8px;
      display: block;
    }
    
    .metric-value {
      font-size: 1.8rem;
      font-weight: 700;
      display: block;
    }
    
    .metric-badge {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 6px;
      font-weight: bold;
      margin-top: 8px;
      font-size: 0.85rem;
    }
    
    .badge-support {
      background: rgba(40, 167, 69, 0.15);
      color: #28a745;
    }
    
    .badge-resistance {
      background: rgba(220, 53, 69, 0.15);
      color: #dc3545;
    }
    
    .badge-volume {
      background: rgba(88, 166, 255, 0.15);
      color: #58a6ff;
    }
    
    .badge-rsi {
      background: rgba(139, 92, 236, 0.15);
      color: #8b5cf6;
    }
    
    .badge-macd {
      background: rgba(23, 162, 184, 0.15);
      color: #17a2b8;
    }
    
    .alert-container {
      grid-column: 1 / -1;
      background: rgba(30, 34, 40, 0.9);
      border-radius: 20px;
      padding: 25px;
      text-align: center;
      margin-top: 10px;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      font-weight: 600;
      border: 2px solid transparent;
      transition: all 0.4s ease;
      line-height: 1.4;
    }
    
    .alert-container.buy {
      background: rgba(40, 167, 69, 0.1);
      border-color: #28a745;
      color: #28a745;
      box-shadow: 0 0 25px rgba(40, 167, 69, 0.2);
    }
    
    .alert-container.sell {
      background: rgba(220, 53, 69, 0.1);
      border-color: #dc3545;
      color: #dc3545;
      box-shadow: 0 0 25px rgba(220, 53, 69, 0.2);
    }
    
    .alert-container.none {
      background: rgba(108, 117, 125, 0.1);
      border-color: #8b949e;
      color: #8b949e;
    }
    
    .footer {
      text-align: center;
      padding: 30px;
      margin-top: 20px;
      border-top: 1px solid #30363d;
      color: #8b949e;
      font-size: 0.95rem;
    }
    
    .update-time {
      display: inline-block;
      background: rgba(88, 166, 255, 0.1);
      color: #58a6ff;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: 600;
      margin-top: 8px;
      font-size: 1.1rem;
      min-width: 180px;
    }
    
    .config-panel {
      background: #161b22;
      border-radius: 20px;
      padding: 25px;
      margin: 25px 0;
      border: 1px solid #30363d;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
      animation: fadeIn 0.7s ease-out;
    }
    
    .config-title {
      font-size: 1.6rem;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .config-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 15px;
    }
    
    .config-item {
      margin-bottom: 15px;
    }
    
    .config-label {
      display: block;
      margin-bottom: 8px;
      color: #8b949e;
      font-size: 0.95rem;
    }
    
    .config-value {
      font-weight: 700;
      color: #58a6ff;
      font-size: 1.3rem;
    }
    
    .strategy-info {
      background: rgba(23, 162, 184, 0.1);
      border-left: 4px solid #17a2b8;
      padding: 25px;
      border-radius: 0 12px 12px 0;
      margin: 25px 0;
      font-size: 0.98rem;
      line-height: 1.7;
      animation: fadeIn 0.8s ease-out;
    }
    
    .strategy-info h3 {
      color: #17a2b8;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1.4rem;
    }
    
    .strategy-info ul {
      padding-left: 25px;
      margin-top: 12px;
      text-align: left;
    }
    
    .strategy-info li {
      margin-bottom: 8px;
      position: relative;
    }
    
    .strategy-info li:before {
      content: '‚Ä¢';
      color: #17a2b8;
      font-weight: bold;
      position: absolute;
      left: -20px;
    }
    
    .timeframe-badge {
      display: inline-block;
      background: rgba(139, 92, 236, 0.2);
      color: #8b5cf6;
      padding: 3px 12px;
      border-radius: 15px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-left: 8px;
      letter-spacing: 0.3px;
    }
    
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 80vh;
      text-align: center;
      padding: 20px;
    }
    
    .spinner {
      width: 60px;
      height: 60px;
      border: 5px solid rgba(88, 166, 255, 0.2);
      border-top: 5px solid #58a6ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 25px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .loading-text {
      font-size: 1.8rem;
      margin-bottom: 15px;
      background: linear-gradient(90deg, #58a6ff, #8a6bff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .github-warning {
      background: rgba(255, 193, 7, 0.15);
      border: 1px solid #ffc107;
      border-radius: 12px;
      padding: 20px;
      margin: 25px 0;
      text-align: center;
      color: #ffc107;
      font-size: 1.1rem;
      line-height: 1.6;
    }
    
    .github-warning strong {
      display: block;
      margin-bottom: 10px;
      font-size: 1.3rem;
    }
    
    .github-warning code {
      background: rgba(0,0,0,0.3);
      padding: 2px 8px;
      border-radius: 4px;
      font-family: monospace;
    }
    
    .error-container {
      background: rgba(220, 53, 69, 0.1);
      border: 1px solid #dc3545;
      border-radius: 16px;
      padding: 40px;
      text-align: center;
      margin: 40px auto;
      max-width: 800px;
      animation: shake 0.5s;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-10px); }
      40%, 80% { transform: translateX(10px); }
    }
    
    .error-title {
      font-size: 2.5rem;
      color: #dc3545;
      margin-bottom: 20px;
    }
    
    .error-message {
      font-size: 1.3rem;
      margin-bottom: 25px;
      color: #e0e0e0;
    }
    
    .retry-btn {
      background: #28a745;
      color: white;
      border: none;
      padding: 12px 30px;
      font-size: 1.1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    
    .retry-btn:hover {
      background: #218838;
      transform: scale(1.05);
    }
    
    .last-update {
      background: rgba(88, 166, 255, 0.1);
      display: inline-block;
      padding: 4px 15px;
      border-radius: 20px;
      font-size: 0.95rem;
      margin-top: 10px;
      color: #58a6ff;
    }
    
    .proxy-info {
      background: rgba(102, 16, 242, 0.15);
      border-left: 4px solid #6610f2;
      padding: 15px;
      margin: 20px 0;
      border-radius: 0 8px 8px 0;
      font-size: 0.9rem;
    }
    
    .macd-chart-container {
      margin-top: 25px;
      padding: 20px;
      background: rgba(30, 34, 40, 0.5);
      border-radius: 12px;
      border: 1px solid #30363d;
    }
    
    .macd-chart-title {
      text-align: center;
      font-size: 1.3rem;
      margin-bottom: 15px;
      color: #17a2b8;
      font-weight: 600;
    }
    
    canvas {
      width: 100%;
      height: 300px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid #30363d;
    }
    
    .macd-legend {
      display: flex;
      justify-content: center;
      gap: 25px;
      margin-top: 15px;
      font-size: 0.9rem;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }
    
    .context-timing-explanation {
      background: linear-gradient(135deg, rgba(88, 166, 255, 0.1), rgba(139, 92, 236, 0.1));
      border: 1px solid rgba(88, 166, 255, 0.3);
      border-radius: 16px;
      padding: 30px;
      margin: 30px 0;
      position: relative;
      overflow: hidden;
    }
    
    .context-timing-explanation::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, #58a6ff, #8b5cf6, #28a745);
    }
    
    .context-timing-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-top: 20px;
    }
    
    .context-card, .timing-card {
      background: rgba(22, 27, 34, 0.7);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .context-card {
      border-left: 4px solid #58a6ff;
    }
    
    .timing-card {
      border-left: 4px solid #28a745;
    }
    
    .context-title, .timing-title {
      font-size: 1.5rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .context-title {
      color: #58a6ff;
    }
    
    .timing-title {
      color: #28a745;
    }
    
    .context-timing-comparison {
      background: rgba(30, 34, 40, 0.6);
      padding: 20px;
      border-radius: 12px;
      margin-top: 25px;
      border: 1px solid #30363d;
    }
    
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 0.95rem;
    }
    
    .comparison-table th {
      background: rgba(88, 166, 255, 0.2);
      padding: 12px;
      text-align: left;
      font-weight: 600;
    }
    
    .comparison-table td {
      padding: 10px 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .comparison-table tr:hover td {
      background: rgba(255, 255, 255, 0.03);
    }
    
    @media (max-width: 1100px) {
      .dashboard-grid {
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }
    }
    
    @media (max-width: 768px) {
      h1 {
        font-size: 2.8rem;
      }
      
      .subtitle {
        font-size: 1.2rem;
      }
      
      .price-display {
        font-size: 3.3rem;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .metric-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .card {
        padding: 22px;
      }
      
      .config-grid {
        grid-template-columns: 1fr;
      }
      
      .strategy-info {
        border-radius: 12px;
        padding: 20px;
      }
      
      .github-warning {
        padding: 15px;
        font-size: 1rem;
      }
      
      .context-timing-grid {
        grid-template-columns: 1fr;
      }
      
      canvas {
        height: 250px;
      }
    }
    
    @media (max-width: 480px) {
      body {
        padding: 12px;
      }
      
      h1 {
        font-size: 2.4rem;
      }
      
      .subtitle {
        font-size: 1.05rem;
      }
      
      .price-display {
        font-size: 2.8rem;
      }
      
      .metric-grid {
        grid-template-columns: 1fr;
      }
      
      .metric-value {
        font-size: 1.6rem;
      }
      
      .card {
        padding: 18px;
      }
      
      .strategy-info {
        padding: 15px;
      }
      
      .strategy-info ul {
        padding-left: 20px;
      }
      
      .loading-text {
        font-size: 1.5rem;
      }
      
      .spinner {
        width: 50px;
        height: 50px;
      }
      
      canvas {
        height: 200px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="loading-container" id="loadingScreen">
      <div class="spinner"></div>
      <div class="loading-text">Carregando dados da Binance...</div>
      <div class="github-warning">
        <strong>üöÄ GitHub Pages - Multi-Timeframe MACD</strong><br>
        Dashboard com an√°lise Contexto (5m) + Timing (1h)<br>
        Incluindo gr√°fico visual do MACD em tempo real!<br>
        <small style="display: block; margin-top: 10px; opacity: 0.8;">
          Atualiza√ß√µes a cada 60 segundos ‚Ä¢ Dados em tempo real
        </small>
      </div>
      <div class="proxy-info">
        <i class="fas fa-shield-alt"></i> Proxy CORS: api.allorigins.win (p√∫blico gratuito)
      </div>
    </div>
    
    <div id="dashboardContent" style="display: none;">
      <!-- Conte√∫do ser√° inserido aqui -->
    </div>
  </div>

  <script>
    /**
     * SOL Sniper PRO - Multi-Timeframe com Gr√°fico MACD 1h
     * 
     * CONCEITOS:
     * 
     * CONTEXTO (5m) = An√°lise de curto prazo
     * - Identifica oportunidades imediatas
     * - Usa RSI, Suporte/Resist√™ncia, Volume
     * - Responde r√°pido √†s mudan√ßas de mercado
     * 
     * TIMING (1h) = Confirma√ß√£o de longo prazo  
     * - Valida a dire√ß√£o principal da tend√™ncia
     * - Usa MACD (12, 26, 9) como filtro
     * - Evita falsos sinais do curto prazo
     * 
     * ESTRAT√âGIA INVERTIDA:
     * Tradicional: 1h = contexto, 5m = timing
     * Esta vers√£o: 5m = contexto, 1h = timing
     * Benef√≠cio: Ideal para day traders que querem
     *            entradas r√°pidas com seguran√ßa
     */

    const CONFIG = {
      SYMBOL: 'SOLUSDT',
      INTERVAL_5M: '5m',
      INTERVAL_1H: '1h',
      RSI_PERIOD: 14,
      MACD_FAST: 12,
      MACD_SLOW: 26,
      MACD_SIGNAL: 9,
      TOLERANCE: 1.2,
      VOLUME_THRESHOLD: 1.5,
      UPDATE_INTERVAL: 60000,
      CANDLES_LIMIT_5M: 100,
      CANDLES_LIMIT_1H: 100,
      DB_NAME: 'sol_sniper_multitimeframe',
      CORS_PROXY: 'https://api.allorigins.win/raw?url='
    };

    let db = {
      prices: [],
      signals: [],
      lastSuccessfulData: null
    };

    function loadDb() {
      try {
        const savedPrices = localStorage.getItem(`${CONFIG.DB_NAME}_prices`);
        const savedSignals = localStorage.getItem(`${CONFIG.DB_NAME}_signals`);
        const savedLastData = localStorage.getItem(`${CONFIG.DB_NAME}_lastData`);
        
        if (savedPrices) db.prices = JSON.parse(savedPrices);
        if (savedSignals) db.signals = JSON.parse(savedSignals);
        if (savedLastData) db.lastSuccessfulData = JSON.parse(savedLastData);
      } catch (e) {
        console.error('Erro ao carregar banco de dados:', e);
        db = { prices: [], signals: [], lastSuccessfulData: null };
      }
    }

    function saveDb() {
      try {
        localStorage.setItem(`${CONFIG.DB_NAME}_prices`, JSON.stringify(db.prices));
        localStorage.setItem(`${CONFIG.DB_NAME}_signals`, JSON.stringify(db.signals));
        if (db.lastSuccessfulData) {
          localStorage.setItem(`${CONFIG.DB_NAME}_lastData`, JSON.stringify(db.lastSuccessfulData));
        }
      } catch (e) {
        console.error('Erro ao salvar banco de dados:', e);
      }
    }

    function formatBR(number, decimals = 2) {
      return number.toLocaleString('pt-BR', { 
        minimumFractionDigits: decimals, 
        maximumFractionDigits: decimals 
      });
    }

    function calculateRSI(candles, period = 14) {
      if (candles.length < period + 1) return 50;
      
      let gains = 0;
      let losses = 0;
      
      for (let i = candles.length - period; i < candles.length; i++) {
        const diff = candles[i].close - candles[i - 1].close;
        if (diff >= 0) gains += diff;
        else losses -= diff;
      }
      
      const avgGain = gains / period;
      const avgLoss = losses / period;
      
      if (avgLoss === 0) return 100;
      
      const rs = avgGain / avgLoss;
      return 100 - (100 / (1 + rs));
    }

    function calculateSupportResistance(candles, period = 12) {
      if (candles.length < period) {
        return { support: 0, resistance: 0, distanceToSupport: 0, distanceToResistance: 0, currentPrice: 0 };
      }
      
      const recentCandles = candles.slice(-period);
      const support = Math.min(...recentCandles.map(c => c.low));
      const resistance = Math.max(...recentCandles.map(c => c.high));
      const currentPrice = candles[candles.length - 1].close;
      
      const distanceToSupport = ((currentPrice - support) / support) * 100;
      const distanceToResistance = ((resistance - currentPrice) / resistance) * 100;
      
      return {
        support,
        resistance,
        distanceToSupport,
        distanceToResistance,
        currentPrice
      };
    }

    function analyzeVolume(candles, period = 12) {
      if (candles.length < period) {
        return { currentVolume: 0, avgVolume: 0, ratio: 1, status: 'unknown' };
      }
      
      const recentCandles = candles.slice(-period);
      const currentVolume = recentCandles[recentCandles.length - 1].volume;
      const totalVolume = recentCandles.reduce((sum, c) => sum + c.volume, 0);
      const avgVolume = totalVolume / period;
      const ratio = currentVolume / avgVolume;
      
      let status;
      if (ratio >= 2.0) status = 'Muito Alto';
      else if (ratio >= 1.5) status = 'Alto';
      else if (ratio >= 0.8) status = 'Normal';
      else status = 'Baixo';
      
      return { currentVolume, avgVolume, ratio, status };
    }

    function calculateEMA(candles, period) {
      if (candles.length < period) return [];
      
      const k = 2 / (period + 1);
      const ema = [];
      
      let sum = 0;
      for (let i = 0; i < period; i++) {
        sum += candles[i].close;
      }
      let sma = sum / period;
      ema.push(sma);
      
      for (let i = period; i < candles.length; i++) {
        const currentClose = candles[i].close;
        const previousEMA = ema[ema.length - 1];
        const currentEMA = (currentClose * k) + (previousEMA * (1 - k));
        ema.push(currentEMA);
      }
      
      return ema;
    }

    function calculateMACD(candles, fastPeriod = 12, slowPeriod = 26, signalPeriod = 9) {
      if (candles.length < slowPeriod + signalPeriod) {
        return { macdLine: [], signalLine: [], histogram: [], fastEMA: [], slowEMA: [] };
      }
      
      const fastEMA = calculateEMA(candles, fastPeriod);
      const slowEMA = calculateEMA(candles, slowPeriod);
      
      const macdLine = [];
      const startIndex = slowPeriod - fastPeriod;
      
      for (let i = startIndex; i < fastEMA.length; i++) {
        macdLine.push(fastEMA[i] - slowEMA[i - startIndex]);
      }
      
      const signalLine = calculateEMA(
        macdLine.map((value, index) => ({ close: value })),
        signalPeriod
      );
      
      const histogram = [];
      const signalStartIndex = signalPeriod - 1;
      
      for (let i = signalStartIndex; i < macdLine.length; i++) {
        histogram.push(macdLine[i] - signalLine[i - signalStartIndex]);
      }
      
      return {
        macdLine,
        signalLine,
        histogram,
        fastEMA,
        slowEMA
      };
    }

    function analyzeMACD(macdData) {
      if (!macdData || macdData.histogram.length < 2) {
        return {
          macdValue: 0,
          signalLineValue: 0,
          histogramValue: 0,
          crossover: 'none',
          signal: 'neutral',
          strength: 0
        };
      }
      
      const macdLine = macdData.macdLine;
      const signalLine = macdData.signalLine;
      const histogram = macdData.histogram;
      
      const currentMACD = macdLine[macdLine.length - 1];
      const currentSignal = signalLine[signalLine.length - 1];
      const currentHistogram = histogram[histogram.length - 1];
      const previousHistogram = histogram[histogram.length - 2];
      
      let crossover = 'none';
      let signal = 'neutral';
      let strength = Math.abs(currentHistogram) * 100;
      
      if (previousHistogram < 0 && currentHistogram >= 0) {
        crossover = 'bullish';
        signal = 'bullish';
      } 
      else if (previousHistogram > 0 && currentHistogram <= 0) {
        crossover = 'bearish';
        signal = 'bearish';
      }
      else if (currentHistogram > 0) {
        signal = 'bullish';
      } else if (currentHistogram < 0) {
        signal = 'bearish';
      }
      
      return {
        macdValue: currentMACD,
        signalLineValue: currentSignal,
        histogramValue: currentHistogram,
        crossover,
        signal,
        strength: Math.min(Math.round(strength), 100)
      };
    }

    function checkSignals(price, rsi, sr, volume, macdAnalysis) {
      const rsiOversold = rsi < 30;
      const rsiOverbought = rsi > 70;
      const nearSupport = sr.distanceToSupport <= CONFIG.TOLERANCE;
      const nearResistance = sr.distanceToResistance <= CONFIG.TOLERANCE;
      const highVolume = volume.ratio >= CONFIG.VOLUME_THRESHOLD;
      
      const macdBullish = macdAnalysis.signal === 'bullish' || macdAnalysis.crossover === 'bullish';
      const macdBearish = macdAnalysis.signal === 'bearish' || macdAnalysis.crossover === 'bearish';
      
      let signal = 'NEUTRO';
      let signalType = 'none';
      let strength = 'BAIXA';
      let strengthLevel = 0;
      let message = '';
      let macdConfirmation = false;
      
      // Sinal de compra
      if ((nearSupport || rsiOversold) && macdBullish) {
        signal = 'COMPRA';
        signalType = 'buy';
        strengthLevel = (nearSupport ? 1 : 0) + (rsiOversold ? 1 : 0) + (highVolume ? 1 : 0) + (macdBullish ? 1 : 0);
        macdConfirmation = true;
        
        message = `Tend√™ncia de alta no 5m `;
        if (nearSupport) message += `com suporte pr√≥ximo `;
        if (rsiOversold) message += `${nearSupport ? 'e ' : ''}RSI sobrevendido `;
        if (macdBullish) message += `${(nearSupport || rsiOversold) ? 'com ' : ''}confirma√ß√£o MACD 1h`;
      } 
      // Sinal de venda
      else if ((nearResistance || rsiOverbought) && macdBearish) {
        signal = 'VENDA';
        signalType = 'sell';
        strengthLevel = (nearResistance ? 1 : 0) + (rsiOverbought ? 1 : 0) + (highVolume ? 1 : 0) + (macdBearish ? 1 : 0);
        macdConfirmation = true;
        
        message = `Tend√™ncia de baixa no 5m `;
        if (nearResistance) message += `com resist√™ncia pr√≥xima `;
        if (rsiOverbought) message += `${nearResistance ? 'e ' : ''}RSI sobrecomprado `;
        if (macdBearish) message += `${(nearResistance || rsiOverbought) ? 'com ' : ''}confirma√ß√£o MACD 1h`;
      }
      // Sinal fraco
      else if (nearSupport || rsiOversold) {
        signal = 'COMPRA FRACA';
        signalType = 'buy';
        strengthLevel = (nearSupport ? 1 : 0) + (rsiOversold ? 1 : 0) + (highVolume ? 1 : 0);
        message = `Tend√™ncia de alta no 5m (aguardar confirma√ß√£o MACD 1h)`;
      }
      else if (nearResistance || rsiOverbought) {
        signal = 'VENDA FRACA';
        signalType = 'sell';
        strengthLevel = (nearResistance ? 1 : 0) + (rsiOverbought ? 1 : 0) + (highVolume ? 1 : 0);
        message = `Tend√™ncia de baixa no 5m (aguardar confirma√ß√£o MACD 1h)`;
      }
      
      if (strengthLevel >= 3 && macdConfirmation) {
        strength = 'ALTA';
      } else if (strengthLevel >= 2) {
        strength = 'M√âDIA';
      } else if (strengthLevel >= 1) {
        strength = 'BAIXA';
      }
      
      return {
        signal,
        signalType,
        strength,
        strengthLevel,
        message,
        macdConfirmation,
        rsiOversold,
        rsiOverbought,
        nearSupport,
        nearResistance,
        highVolume,
        macdBullish,
        macdBearish,
        rsi,
        macd: macdAnalysis.macdValue
      };
    }

    // Fun√ß√£o para desenhar gr√°fico MACD
    function drawMACDChart(canvasId, macdData, macdAnalysis) {
      const canvas = document.getElementById(canvasId);
      if (!canvas) return;
      
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      
      // Limpar canvas
      ctx.clearRect(0, 0, width, height);
      
      // Configurar escala
      const padding = 40;
      const chartWidth = width - padding * 2;
      const chartHeight = height - padding * 2;
      
      // Encontrar valores m√°ximos e m√≠nimos
      const allValues = [
        ...macdData.macdLine.slice(-50),
        ...macdData.signalLine.slice(-50),
        ...macdData.histogram.slice(-50),
        0
      ];
      
      const maxValue = Math.max(...allValues.map(Math.abs)) * 1.2;
      const minValue = -maxValue;
      
      // Fun√ß√£o para mapear valores para coordenadas Y
      const scaleY = (value) => {
        return height - padding - ((value - minValue) / (maxValue - minValue)) * chartHeight;
      };
      
      // Desenhar linha zero
      ctx.beginPath();
      ctx.moveTo(padding, scaleY(0));
      ctx.lineTo(width - padding, scaleY(0));
      ctx.strokeStyle = '#8b949e';
      ctx.lineWidth = 1;
      ctx.setLineDash([5, 5]);
      ctx.stroke();
      ctx.setLineDash([]);
      
      // Desenhar eixo Y labels
      ctx.fillStyle = '#8b949e';
      ctx.font = '10px Arial';
      ctx.textAlign = 'right';
      
      const labelValues = [maxValue, maxValue/2, 0, minValue/2, minValue];
      labelValues.forEach(val => {
        ctx.fillText(formatBR(val, 6), padding - 10, scaleY(val) + 3);
      });
      
      // Desenhar histograma
      const histogramSlice = macdData.histogram.slice(-50);
      const barWidth = chartWidth / histogramSlice.length;
      
      histogramSlice.forEach((value, index) => {
        const x = padding + index * barWidth;
        const yZero = scaleY(0);
        const yValue = scaleY(value);
        
        ctx.fillStyle = value >= 0 ? 'rgba(40, 167, 69, 0.6)' : 'rgba(220, 53, 69, 0.6)';
        ctx.fillRect(x, Math.min(yZero, yValue), barWidth - 2, Math.abs(yZero - yValue));
      });
      
      // Desenhar linha MACD
      ctx.beginPath();
      const macdSlice = macdData.macdLine.slice(-50);
      macdSlice.forEach((value, index) => {
        const x = padding + index * barWidth + barWidth/2;
        const y = scaleY(value);
        
        if (index === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.strokeStyle = '#58a6ff';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Desenhar linha Signal
      ctx.beginPath();
      const signalSlice = macdData.signalLine.slice(-50);
      signalSlice.forEach((value, index) => {
        const x = padding + index * barWidth + barWidth/2;
        const y = scaleY(value);
        
        if (index === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.strokeStyle = '#8b5cf6';
      ctx.lineWidth = 2;
      ctx.stroke();
      
      // Destacar crossover se houver
      if (macdAnalysis.crossover !== 'none') {
        const lastX = padding + (histogramSlice.length - 1) * barWidth + barWidth/2;
        const lastY = scaleY(macdAnalysis.macdValue);
        
        ctx.beginPath();
        ctx.arc(lastX, lastY, 8, 0, Math.PI * 2);
        ctx.fillStyle = macdAnalysis.crossover === 'bullish' ? 'rgba(40, 167, 69, 0.3)' : 'rgba(220, 53, 69, 0.3)';
        ctx.fill();
        
        ctx.beginPath();
        ctx.arc(lastX, lastY, 6, 0, Math.PI * 2);
        ctx.strokeStyle = macdAnalysis.crossover === 'bullish' ? '#28a745' : '#dc3545';
        ctx.lineWidth = 2;
        ctx.stroke();
      }
      
      // Legenda
      ctx.font = '11px Arial';
      ctx.textAlign = 'left';
      
      ctx.fillStyle = '#58a6ff';
      ctx.fillText('MACD Line', padding + 10, padding + 15);
      
      ctx.fillStyle = '#8b5cf6';
      ctx.fillText('Signal Line', padding + 120, padding + 15);
      
      ctx.fillStyle = '#28a745';
      ctx.fillText('Histograma +', padding + 240, padding + 15);
      
      ctx.fillStyle = '#dc3545';
      ctx.fillText('Histograma -', padding + 380, padding + 15);
    }

    function generateDashboard(data) {
      const {
        price,
        rsi,
        sr,
        volume,
        macdAnalysis,
        signals,
        timestamp,
        macdData1h
      } = data;
      
      const rsiStatus = rsi < 30 ? 'Sobrevendido (COMPRA)' : (rsi > 70 ? 'Sobrecomprado (VENDA)' : 'Neutro');
      const rsiColor = rsi < 30 ? '#28a745' : (rsi > 70 ? '#dc3545' : '#8b949e');
      const volStatus = volume.ratio >= 1.5 ? 'Alto' : 'Normal';
      const volColor = volume.ratio >= 1.5 ? '#ff9800' : '#8b949e';
      const distSupColor = sr.distanceToSupport <= 1.2 ? '#28a745' : '#8b949e';
      const distResColor = sr.distanceToResistance <= 1.2 ? '#dc3545' : '#8b949e';
      
      const timestampBR = new Date(timestamp).toLocaleString('pt-BR', { 
        timeZone: 'America/Sao_Paulo',
        hour12: false 
      });
      
      return `
        <header>
          <h1>üéØ SOL Sniper PRO <span class="timeframe-badge">Multi-Timeframe MACD 1h</span></h1>
          <div class="subtitle">
            Sistema avan√ßado com an√°lise invertida: <strong>Contexto 5m</strong> + <strong>Timing 1h</strong> com gr√°fico visual MACD em tempo real
          </div>
          
          <div class="status-bar">
            <span class="status-indicator"></span>
            <span><strong>Conectado via Proxy CORS</strong> ‚Ä¢ Atualizando a cada 60 segundos</span>
          </div>
          
          <div class="context-timing-explanation">
            <h2 style="color: #c9d1d9; margin-bottom: 20px; text-align: center; font-size: 1.8rem;">
              üìä <strong>CONTEXTO vs TIMING</strong> - Estrat√©gia Multi-Timeframe
            </h2>
            
            <div class="context-timing-grid">
              <div class="context-card">
                <div class="context-title">
                  <i class="fas fa-stopwatch"></i> CONTEXTO (5m)
                </div>
                <p><strong>O que √©:</strong> An√°lise de <span style="color: #58a6ff; font-weight: 600;">curto prazo</span> para identificar oportunidades imediatas</p>
                <p><strong>Fun√ß√£o:</strong> Detectar movimentos antes que aconte√ßam no timeframe maior</p>
                <p><strong>Indicadores:</strong></p>
                <ul style="padding-left: 20px; margin: 10px 0;">
                  <li><strong>RSI (14):</strong> Condi√ß√µes de sobrecompra/sobrevenda</li>
                  <li><strong>Suporte/Resist√™ncia:</strong> N√≠veis recentes (√∫ltima 1h)</li>
                  <li><strong>Volume:</strong> For√ßa do movimento atual</li>
                </ul>
                <p><strong>Por que 5m:</strong> Responde r√°pido √†s mudan√ßas, ideal para day trading</p>
              </div>
              
              <div class="timing-card">
                <div class="timing-title">
                  <i class="fas fa-clock"></i> TIMING (1h)
                </div>
                <p><strong>O que √©:</strong> An√°lise de <span style="color: #28a745; font-weight: 600;">longo prazo</span> para confirma√ß√£o de dire√ß√£o</p>
                <p><strong>Fun√ß√£o:</strong> Validar se a tend√™ncia principal est√° alinhada</p>
                <p><strong>Indicador Principal:</strong></p>
                <ul style="padding-left: 20px; margin: 10px 0;">
                  <li><strong>MACD (12, 26, 9):</strong></li>
                  <ul style="padding-left: 20px; margin: 8px 0;">
                    <li>MACD Line = EMA 12 - EMA 26</li>
                    <li>Signal Line = EMA 9 do MACD Line</li>
                    <li>Histograma = MACD Line - Signal Line</li>
                  </ul>
                </ul>
                <p><strong>Por que 1h:</strong> Filtra ru√≠do, confirma tend√™ncia real</p>
              </div>
            </div>
            
            <div class="context-timing-comparison">
              <h3 style="color: #17a2b8; margin-bottom: 15px;">
                <i class="fas fa-exchange-alt"></i> Estrat√©gia "Timeframes Invertidos"
              </h3>
              <table class="comparison-table">
                <thead>
                  <tr>
                    <th>Abordagem Tradicional</th>
                    <th>Abordagem Invertida (Este Sistema)</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>1h = Contexto (dire√ß√£o principal)</td>
                    <td><strong style="color: #58a6ff;">5m = Contexto</strong> (oportunidade)</td>
                  </tr>
                  <tr>
                    <td>5m = Timing (entrada)</td>
                    <td><strong style="color: #28a745;">1h = Timing</strong> (confirma√ß√£o)</td>
                  </tr>
                  <tr>
                    <td>Para swing traders</td>
                    <td>Para <strong>day traders r√°pidos</strong></td>
                  </tr>
                  <tr>
                    <td>Entradas menos frequentes</td>
                    <td>Entradas <strong>r√°pidas + seguran√ßa</strong></td>
                  </tr>
                </tbody>
              </table>
              
              <div style="margin-top: 20px; padding: 15px; background: rgba(23, 162, 184, 0.15); border-radius: 8px;">
                <h4 style="color: #17a2b8; margin-bottom: 10px;">
                  <i class="fas fa-brain"></i> L√≥gica da Estrat√©gia:
                </h4>
                <p><strong style="color: #28a745;">SINAL DE COMPRA:</strong></p>
                <ul style="padding-left: 20px; margin: 8px 0;">
                  <li>5m: Pre√ßo pr√≥ximo do suporte <strong>OU</strong> RSI sobrevendido</li>
                  <li>5m: Volume acima da m√©dia (confirma√ß√£o)</li>
                  <li>1h: MACD bullish (crossover de alta ou acima de zero)</li>
                </ul>
                <p style="margin-top: 10px;"><strong style="color: #dc3545;">SINAL DE VENDA:</strong></p>
                <ul style="padding-left: 20px; margin: 8px 0;">
                  <li>5m: Pre√ßo pr√≥ximo da resist√™ncia <strong>OU</strong> RSI sobrecomprado</li>
                  <li>5m: Volume acima da m√©dia (confirma√ß√£o)</li>
                  <li>1h: MACD bearish (crossover de baixa ou abaixo de zero)</li>
                </ul>
              </div>
            </div>
          </div>
          
          <div class="strategy-info">
            <h3><i class="fas fa-calculator"></i> C√°lculo do MACD (1h) - Explica√ß√£o T√©cnica</h3>
            <p><strong>F√≥rmula Completa:</strong></p>
            <ul>
              <li><strong>Passo 1:</strong> Calcular EMA de 12 per√≠odos (Fast EMA)</li>
              <li><strong>Passo 2:</strong> Calcular EMA de 26 per√≠odos (Slow EMA)</li>
              <li><strong>Passo 3:</strong> MACD Line = Fast EMA - Slow EMA</li>
              <li><strong>Passo 4:</strong> Signal Line = EMA de 9 per√≠odos do MACD Line</li>
              <li><strong>Passo 5:</strong> Histograma = MACD Line - Signal Line</li>
            </ul>
            <p><strong>Interpreta√ß√£o:</strong></p>
            <ul>
              <li><span style="color: #28a745;">MACD acima de zero</span> = Tend√™ncia de alta</li>
              <li><span style="color: #dc3545;">MACD abaixo de zero</span> = Tend√™ncia de baixa</li>
              <li><span style="color: #28a745;">Crossover de alta</span> (Histograma cruza de negativo para positivo) = Sinal de compra</li>
              <li><span style="color: #dc3545;">Crossover de baixa</span> (Histograma cruza de positivo para negativo) = Sinal de venda</li>
            </ul>
          </div>
        </header>
        
        <div class="config-panel">
          <div class="config-title">
            <i class="fas fa-cog"></i> Configura√ß√£o do Sistema
          </div>
          <div class="config-grid">
            <div class="config-item">
              <span class="config-label">Par Monitorado</span>
              <div class="config-value">SOL/USDT</div>
            </div>
            <div class="config-item">
              <span class="config-label">Contexto (TF)</span>
              <div class="config-value">5m <span class="timeframe-badge">RSI + S/R + Vol</span></div>
            </div>
            <div class="config-item">
              <span class="config-label">Timing (TF)</span>
              <div class="config-value">1h <span class="timeframe-badge">MACD</span></div>
            </div>
            <div class="config-item">
              <span class="config-label">Per√≠odo RSI</span>
              <div class="config-value">14 velas</div>
            </div>
            <div class="config-item">
              <span class="config-label">MACD Parameters</span>
              <div class="config-value">(12, 26, 9)</div>
            </div>
            <div class="config-item">
              <span class="config-label">Toler√¢ncia S/R</span>
              <div class="config-value">1,2%</div>
            </div>
            <div class="config-item">
              <span class="config-label">Threshold Volume</span>
              <div class="config-value">1,5x m√©dia</div>
            </div>
            <div class="config-item">
              <span class="config-label">√öltima Atualiza√ß√£o</span>
              <div class="config-value">${timestampBR}</div>
            </div>
            <div class="config-item">
              <span class="config-label">Proxy CORS</span>
              <div class="config-value">api.allorigins.win</div>
            </div>
            <div class="config-item">
              <span class="config-label">Ambiente</span>
              <div class="config-value">GitHub Pages</div>
            </div>
          </div>
        </div>
        
        <div class="dashboard-grid">
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-coins"></i> Pre√ßo Atual
              </div>
              <div>
                <span class="metric-badge badge-rsi">SOL/USDT</span>
              </div>
            </div>
            <div class="price-display">
              R$${formatBR(price, 2)} <small>USDT</small>
            </div>
            <div class="alert-container ${signals.signalType}">
              ${signals.message || 'Sem sinal definido no momento'}
              ${signals.macdConfirmation ? '<br><small style="opacity:0.8">‚úÖ Confirma√ß√£o MACD 1h</small>' : ''}
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-chart-line"></i> Indicadores 5m (Contexto)
              </div>
            </div>
            <div class="metric-grid">
              <div class="metric-item">
                <span class="metric-label">RSI (14)</span>
                <span class="metric-value" style="color: ${rsiColor};">${formatBR(rsi, 2)}</span>
                <span class="metric-badge badge-rsi" style="color: ${rsiColor};">${rsiStatus}</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">Volume</span>
                <span class="metric-value" style="color: ${volColor};">${formatBR(volume.ratio, 2)}x</span>
                <span class="metric-badge badge-volume" style="color: ${volColor};">${volStatus}</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">5m Alta</span>
                <span class="metric-value">R$${formatBR(sr.resistance, 2)}</span>
                <span class="metric-badge badge-resistance">Resist√™ncia</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">5m Baixa</span>
                <span class="metric-value">R$${formatBR(sr.support, 2)}</span>
                <span class="metric-badge badge-support">Suporte</span>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-bullseye"></i> An√°lise 5m (Contexto)
              </div>
            </div>
            <div class="metric-grid">
              <div class="metric-item">
                <span class="metric-label">Dist. Suporte</span>
                <span class="metric-value" style="color: ${distSupColor};">${formatBR(sr.distanceToSupport, 2)}%</span>
                <span class="metric-badge badge-support" style="color: ${distSupColor};">${sr.distanceToSupport <= 1.2 ? 'PR√ìXIMO' : 'DISTANTE'}</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">Dist. Resist√™ncia</span>
                <span class="metric-value" style="color: ${distResColor};">${formatBR(sr.distanceToResistance, 2)}%</span>
                <span class="metric-badge badge-resistance" style="color: ${distResColor};">${sr.distanceToResistance <= 1.2 ? 'PR√ìXIMO' : 'DISTANTE'}</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">Sinal 5m</span>
                <span class="metric-value">${signals.signal}</span>
                <span class="metric-badge badge-rsi">${signals.strength}</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">For√ßa Sinal</span>
                <span class="metric-value">${signals.strengthLevel}/4</span>
                <span class="metric-badge badge-rsi">${signals.strength}</span>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="card-header">
              <div class="card-title">
                <i class="fas fa-stopwatch"></i> Timing 1h (MACD)
              </div>
            </div>
            <div class="metric-grid">
              <div class="metric-item">
                <span class="metric-label">MACD</span>
                <span class="metric-value" style="color: ${macdAnalysis.signal === 'bullish' ? '#28a745' : (macdAnalysis.signal === 'bearish' ? '#dc3545' : '#8b949e')}">${formatBR(macdAnalysis.macdValue, 6)}</span>
                <span class="metric-badge badge-macd" style="color: ${macdAnalysis.signal === 'bullish' ? '#28a745' : (macdAnalysis.signal === 'bearish' ? '#dc3545' : '#8b949e')}">${macdAnalysis.signal.toUpperCase()}</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">Signal Line</span>
                <span class="metric-value">${formatBR(macdAnalysis.signalLineValue, 6)}</span>
                <span class="metric-badge badge-macd">EMA 9</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">Histograma</span>
                <span class="metric-value" style="color: ${macdAnalysis.histogramValue >= 0 ? '#28a745' : '#dc3545'}">${macdAnalysis.histogramValue >= 0 ? '+' : ''}${formatBR(macdAnalysis.histogramValue, 6)}</span>
                <span class="metric-badge badge-macd" style="color: ${macdAnalysis.histogramValue >= 0 ? '#28a745' : '#dc3545'}">${macdAnalysis.histogramValue >= 0 ? 'ACIMA' : 'ABAIXO'} ZERO</span>
              </div>
              <div class="metric-item">
                <span class="metric-label">Crossover</span>
                <span class="metric-value">${macdAnalysis.crossover === 'bullish' ? 'ALTA' : (macdAnalysis.crossover === 'bearish' ? 'BAIXA' : '---')}</span>
                <span class="metric-badge badge-macd">${macdAnalysis.crossover === 'bullish' ? 'CONFIRMADO' : (macdAnalysis.crossover === 'bearish' ? 'CONFIRMADO' : 'AGUARDANDO')}</span>
              </div>
            </div>
            
            <div class="macd-chart-container">
              <div class="macd-chart-title">
                <i class="fas fa-chart-bar"></i> Gr√°fico MACD 1h (√öltimas 50 velas)
              </div>
              <canvas id="macdChart" width="800" height="300"></canvas>
              <div class="macd-legend">
                <div class="legend-item">
                  <div class="legend-color" style="background: #58a6ff;"></div>
                  <span>MACD Line (12,26)</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color" style="background: #8b5cf6;"></div>
                  <span>Signal Line (9)</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color" style="background: rgba(40, 167, 69, 0.6);"></div>
                  <span>Histograma +</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color" style="background: rgba(220, 53, 69, 0.6);"></div>
                  <span>Histograma -</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="footer">
          <p><i class="fas fa-robot"></i> SOL Sniper PRO v6.0 ‚Ä¢ Multi-Timeframe MACD 1h</p>
          <p>Fonte: Binance API via Proxy CORS ‚Ä¢ Atualiza√ß√£o autom√°tica a cada 60s</p>
          <div class="update-time" id="countdownTimer">Pr√≥xima atualiza√ß√£o em: 60s</div>
          ${db.lastSuccessfulData ? `<div class="last-update">√öltima atualiza√ß√£o: ${new Date(db.lastSuccessfulData.timestamp).toLocaleString('pt-BR', { timeZone: 'America/Sao_Paulo', hour12: false })}</div>` : ''}
          <p style="margin-top: 12px; font-size: 0.9rem; opacity: 0.7;">
            <i class="fas fa-exclamation-triangle"></i> Este sistema √© para fins educacionais. Opere com responsabilidade e sempre use stop loss.
          </p>
          <p style="margin-top: 8px; font-size: 0.85rem; opacity: 0.6;">
            ‚ö†Ô∏è Proxy p√∫blico gratuito - pode ter limita√ß√µes de uso. Para produ√ß√£o, configure seu pr√≥prio proxy.
          </p>
        </div>
      `;
    }

    function startCountdown() {
      let seconds = 60;
      const timerElement = document.getElementById('countdownTimer');
      
      if (!timerElement) return;
      
      const interval = setInterval(() => {
        seconds--;
        timerElement.textContent = `Pr√≥xima atualiza√ß√£o em: ${seconds}s`;
        
        if (seconds <= 0) {
          seconds = 60;
          runAnalysis();
        }
      }, 1000);
      
      return interval;
    }

    async function runAnalysis() {
      console.log('\n--- SOL Sniper PRO Multi-Timeframe: ' + new Date().toLocaleTimeString('pt-BR', { timeZone: 'America/Sao_Paulo' }) + ' ---');
      
      try {
        loadDb();
        
        const url5m = `https://api.binance.com/api/v3/klines?symbol=${CONFIG.SYMBOL}&interval=${CONFIG.INTERVAL_5M}&limit=${CONFIG.CANDLES_LIMIT_5M}`;
        const url1h = `https://api.binance.com/api/v3/klines?symbol=${CONFIG.SYMBOL}&interval=${CONFIG.INTERVAL_1H}&limit=${CONFIG.CANDLES_LIMIT_1H}`;
        
        const proxyUrl5m = CONFIG.CORS_PROXY + encodeURIComponent(url5m);
        const proxyUrl1h = CONFIG.CORS_PROXY + encodeURIComponent(url1h);
        
        console.log('üì° Buscando dados via proxy CORS...');
        
        const response5m = await fetch(proxyUrl5m);
        if (!response5m.ok) throw new Error(`Erro API 5m: ${response5m.status}`);
        const data5m = await response5m.json();
        
        // ‚úÖ Verifica√ß√£o cr√≠tica de dados
        if (!Array.isArray(data5m)) {
          throw new Error('Resposta da API 5m n√£o √© um array v√°lido');
        }
        
        const candles5m = data5m.map(d => ({
          time: d[0], 
          close: parseFloat(d[4]), 
          high: parseFloat(d[2]), 
          low: parseFloat(d[3]),
          volume: parseFloat(d[5])
        }));

        const response1h = await fetch(proxyUrl1h);
        if (!response1h.ok) throw new Error(`Erro API 1h: ${response1h.status}`);
        const data1h = await response1h.json();
        
        // ‚úÖ Verifica√ß√£o cr√≠tica de dados
        if (!Array.isArray(data1h)) {
          throw new Error('Resposta da API 1h n√£o √© um array v√°lido');
        }
        
        const candles1h = data1h.map(d => ({
          time: d[0], 
          close: parseFloat(d[4]), 
          high: parseFloat(d[2]), 
          low: parseFloat(d[3]),
          volume: parseFloat(d[5])
        }));

        const currentPrice = candles5m[candles5m.length - 1].close;
        const rsiValue = calculateRSI(candles5m, CONFIG.RSI_PERIOD);
        const sr = calculateSupportResistance(candles5m, 12);
        const volumeInfo = analyzeVolume(candles5m, 12);
        
        const macdData = calculateMACD(candles1h, CONFIG.MACD_FAST, CONFIG.MACD_SLOW, CONFIG.MACD_SIGNAL);
        const macdAnalysis = analyzeMACD(macdData);

        const signals = checkSignals(currentPrice, rsiValue, sr, volumeInfo, macdAnalysis);

        console.log(`‚úÖ Dados recebidos com sucesso!`);
        console.log(`üíµ Pre√ßo: R$${formatBR(currentPrice, 2)} | RSI: ${formatBR(rsiValue, 2)} | Vol: ${formatBR(volumeInfo.ratio, 2)}x`);
        console.log(`üìä MACD 1h: ${formatBR(macdAnalysis.macdValue, 6)} | Histograma: ${formatBR(macdAnalysis.histogramValue, 6)} | Crossover: ${macdAnalysis.crossover}`);

        db.prices.push({ timestamp: Date.now(), price: currentPrice });
        if (db.prices.length > 1000) db.prices = db.prices.slice(-1000);

        if (signals.strength === 'ALTA' && signals.macdConfirmation) {
          const lastSignal = db.signals[db.signals.length - 1];
          const isDifferent = !lastSignal || 
            (lastSignal.signal.includes('COMPRA') && signals.signal.includes('VENDA')) ||
            (lastSignal.signal.includes('VENDA') && signals.signal.includes('COMPRA'));
          
          if (isDifferent) {
            db.signals.push({
              timestamp: Date.now(),
              signal: signals.signal,
              price: currentPrice,
              rsi: rsiValue,
              macd: macdAnalysis.macdValue,
              strength: signals.strength
            });
            
            if (db.signals.length > 50) db.signals = db.signals.slice(-50);
            
            console.log(`üéØ SINAL FORTE: ${signals.signal} | R$${formatBR(currentPrice, 2)}`);
          }
        }

        db.lastSuccessfulData = {
          price: currentPrice,
          rsi: rsiValue,
          sr,
          volume: volumeInfo,
          macdAnalysis,
          macdData1h: macdData,
          signals,
          timestamp: new Date()
        };
        
        saveDb();

        renderDashboard({
          price: currentPrice,
          rsi: rsiValue,
          sr,
          volume: volumeInfo,
          macdAnalysis,
          macdData1h: macdData,
          signals,
          timestamp: new Date()
        });

        return { price: currentPrice, rsi: rsiValue, signals, timestamp: new Date() };

      } catch (err) {
        console.error('‚ùå Erro:', err.message);
        
        if (db.lastSuccessfulData) {
          console.log('üíæ Usando dados em cache...');
          renderDashboard(db.lastSuccessfulData);
          
          const footer = document.querySelector('.footer');
          if (footer) {
            const errorDiv = document.createElement('div');
            errorDiv.style.color = '#ffc107';
            errorDiv.style.marginTop = '10px';
            errorDiv.style.fontSize = '0.85rem';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Erro: ${err.message}. Usando dados em cache.`;
            footer.appendChild(errorDiv);
          }
          
          return db.lastSuccessfulData;
        } else {
          renderError(err);
          return null;
        }
      }
    }

    function renderDashboard(data) {
      document.getElementById('loadingScreen').style.display = 'none';
      const dashboardContent = document.getElementById('dashboardContent');
      dashboardContent.style.display = 'block';
      dashboardContent.innerHTML = generateDashboard(data);
      
      // Desenhar gr√°fico MACD ap√≥s o DOM estar pronto
      setTimeout(() => {
        drawMACDChart('macdChart', data.macdData1h, data.macdAnalysis);
      }, 100);
      
      startCountdown();
    }

    function renderError(error) {
      document.getElementById('loadingScreen').style.display = 'none';
      
      const dashboardContent = document.getElementById('dashboardContent');
      dashboardContent.style.display = 'block';
      dashboardContent.innerHTML = `
        <div class="error-container">
          <div class="error-title">
            <i class="fas fa-exclamation-triangle"></i> Erro na Conex√£o
          </div>
          <div class="error-message">
            ${error.message || 'N√£o foi poss√≠vel buscar os dados'}
          </div>
          <div style="margin: 25px 0; text-align: left; color: #8b949e; line-height: 1.6;">
            <p><strong>Poss√≠veis causas:</strong></p>
            <ul style="padding-left: 20px; margin-top: 10px;">
              <li>Limite de requisi√ß√µes do proxy CORS gratuito</li>
              <li>API da Binance temporariamente indispon√≠vel</li>
              <li>Sem conex√£o com a internet</li>
            </ul>
            <p style="margin-top: 15px;"><strong>Solu√ß√£o:</strong></p>
            <ul style="padding-left: 20px; margin-top: 10px;">
              <li>Aguarde alguns minutos e tente novamente</li>
              <li>Atualize a p√°gina (F5)</li>
              <li>Verifique sua conex√£o com a internet</li>
            </ul>
          </div>
          <button class="retry-btn" onclick="runAnalysis()">
            <i class="fas fa-redo"></i> Tentar Novamente
          </button>
          ${db.lastSuccessfulData ? `
            <div style="margin-top: 20px;">
              <button class="retry-btn" style="background: #6f42c1;" onclick="renderDashboard(db.lastSuccessfulData)">
                <i class="fas fa-history"></i> Usar Dados em Cache
              </button>
            </div>
          ` : ''}
        </div>
      `;
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadDb();
      
      if (db.lastSuccessfulData) {
        console.log('üíæ Carregando dados em cache...');
        renderDashboard(db.lastSuccessfulData);
        setTimeout(runAnalysis, 3000);
      } else {
        runAnalysis();
      }
    });
  </script>
</body>
</html>
